(()=>{"use strict";const e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.thrown"),n=e=>"object"==typeof e&&null!==e||"function"==typeof e,o=new Map([["proxy",{canHandle:t=>n(t)&&t[e],serialize(e){const{port1:t,port2:r}=new MessageChannel;return a(e,t),[r,[r]]},deserialize(e){return e.start(),f(e,[],t);var t}}],["throw",{canHandle:e=>n(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function a(t,r=self){r.addEventListener("message",function n(o){if(!o||!o.data)return;const{id:c,type:f,path:u}=Object.assign({path:[]},o.data),h=(o.data.argumentList||[]).map(d);let m;try{const r=u.slice(0,-1).reduce((e,t)=>e[t],t),s=u.reduce((e,t)=>e[t],t);switch(f){case"GET":m=s;break;case"SET":r[u.slice(-1)[0]]=d(o.data.value),m=!0;break;case"APPLY":m=s.apply(r,h);break;case"CONSTRUCT":m=function(t){return Object.assign(t,{[e]:!0})}(new s(...h));break;case"ENDPOINT":{const{port1:e,port2:r}=new MessageChannel;a(t,r),m=function(e,t){return l.set(e,t),e}(e,[e])}break;case"RELEASE":m=void 0;break;default:return}}catch(p){m={value:p,[s]:0}}Promise.resolve(m).catch(e=>({value:e,[s]:0})).then(e=>{const[t,s]=v(e);r.postMessage(Object.assign(Object.assign({},t),{id:c}),s),"RELEASE"===f&&(r.removeEventListener("message",n),i(r))})}),r.start&&r.start()}function i(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function c(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e,s=[],n=function(){}){let o=!1;const a=new Proxy(n,{get(t,n){if(c(o),n===r)return()=>h(e,{type:"RELEASE",path:s.map(e=>e.toString())}).then(()=>{i(e),o=!0});if("then"===n){if(0===s.length)return{then:()=>a};const t=h(e,{type:"GET",path:s.map(e=>e.toString())}).then(d);return t.then.bind(t)}return f(e,[...s,n])},set(t,r,n){c(o);const[a,i]=v(n);return h(e,{type:"SET",path:[...s,r].map(e=>e.toString()),value:a},i).then(d)},apply(r,n,a){c(o);const i=s[s.length-1];if(i===t)return h(e,{type:"ENDPOINT"}).then(d);if("bind"===i)return f(e,s.slice(0,-1));const[l,v]=u(a);return h(e,{type:"APPLY",path:s.map(e=>e.toString()),argumentList:l},v).then(d)},construct(t,r){c(o);const[n,a]=u(r);return h(e,{type:"CONSTRUCT",path:s.map(e=>e.toString()),argumentList:n},a).then(d)}});return a}function u(e){const t=e.map(v);return[t.map(e=>e[0]),(r=t.map(e=>e[1]),Array.prototype.concat.apply([],r))];var r}const l=new WeakMap;function v(e){for(const[t,r]of o)if(r.canHandle(e)){const[s,n]=r.serialize(e);return[{type:"HANDLER",name:t,value:s},n]}return[{type:"RAW",value:e},l.get(e)||[]]}function d(e){switch(e.type){case"HANDLER":return o.get(e.name).deserialize(e.value);case"RAW":return e.value}}function h(e,t,r){return new Promise(s=>{const n=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function t(r){r.data&&r.data.id&&r.data.id===n&&(e.removeEventListener("message",t),s(r.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function m(e){const t=Math.sin(e*Math.PI/180),r=(180-90/Math.PI*Math.log((1+t)/(1-t)))/360;return Math.min(1.5,Math.max(-.5,r))}class p{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}toMercatorCoord(){return{x:(e=this.lng,(180+e)/360),y:m(this.lat)};var e}static fromMercatorCoord(e,t){return new p(function(e){return 360*e-180}(e),function(e){return 180*Math.atan(Math.sinh((180-360*e)*Math.PI/180))/Math.PI}(t))}}a({makeBBElements:function(e,t,r,s,n,o){const a=r.filter(e=>e<=o).length,i=2*a;let c=new Float32Array(2*a),f=new Float32Array(i),u=0,l=0;for(let v=0;v<n;v++)for(let a=0;a<s;a++){const i=v*s+a,d=e[i],h=t[i],m=r[i];if(m>o||void 0===h||void 0===d)continue;const y=new p(h,d).toMercatorCoord();c[u+0]=y.x,c[u+1]=y.y,f[l+0]=Math.min(a/(s-1),.99999)+m,f[l+1]=v/(n-1),u+=2,l+=2}return{pts:c,tex_coords:f}},makeDomainVerticesAndTexCoords:function(e,t,r,s,n,o){const a=new Float32Array(4*(r-1)*(s+1)).fill(0),i=new Float32Array(4*(r-1)*(s+1)).fill(0);let c=0,f=0;for(let u=0;u<r-1;u++)for(let l=0;l<s;l++){const v=u+l*r,d=new p(t[v],e[v]).toMercatorCoord(),h=new p(t[v+1],e[v+1]).toMercatorCoord(),m=u/(r-1)*(1-2*n)+n,y=(u+1)/(r-1)*(1-2*n)+n,g=l/(s-1)*(1-2*o)+o;0==l&&(a[c]=d.x,a[c+1]=d.y,c+=2,i[f]=m,i[f+1]=g,f+=2),a[c]=d.x,a[c+1]=d.y,a[c+2]=h.x,a[c+3]=h.y,c+=4,i[f]=m,i[f+1]=g,i[f+2]=y,i[f+3]=g,f+=4,l==s-1&&(a[c]=h.x,a[c+1]=h.y,c+=2,i[f]=y,i[f+1]=g,f+=2)}return{vertices:a,tex_coords:i}},makePolyLines:function(e){if(0==e.length||0==e[0].vertices.length)return{vertices:new Float32Array([]),extrusion:new Float32Array([])};const t=Object.fromEntries(Object.entries(e[0]).map(([e,t])=>{let r;return r="number"==typeof t||"number"==typeof t[0]?1:t[0].length,[e,r]}));t.extrusion=2,t.vertices+=1;const r=4*e.map(e=>e.vertices.length).reduce((e,t)=>e+t)-2*e.length,s=Object.fromEntries(Object.entries(t).map(([e,t])=>[e,r*t]));let n={vertices:new Float32Array(s.vertices),extrusion:new Float32Array(s.extrusion)};"offsets"in e[0]&&(n.offsets=new Float32Array(s.offsets)),"data"in e[0]&&(n.data=new Float32Array(s.data)),"zoom"in e[0]&&(n.zoom=new Float32Array(s.zoom));let o=Object.fromEntries(Object.keys(s).map(e=>[e,0]));const a=(e,t,r)=>{const s=t[0]-e[0],n=t[1]-e[1],o=Math.hypot(s,n),a=-s/o;return[n/o,r?-a:a]};return e.forEach(e=>{const t=e.vertices.map(e=>{const t=new p(...e).toMercatorCoord();return[t.x,t.y]});if(0==e.vertices.length)return;const r=void 0!==e.offsets,s=void 0!==e.offsets?e.offsets:t;let i,c,f,u=t[0],l=(t[1],s[0]),v=s[1],d=1e-4,[h,m]=a(l,v,!r);n.vertices[o.vertices++]=u[0],n.vertices[o.vertices++]=u[1],n.vertices[o.vertices++]=d,n.extrusion[o.extrusion++]=h,n.extrusion[o.extrusion++]=m;for(let p=1;p<t.length;p++)u=t[p],i=t[p-1],l=s[p],c=s[p-1],[h,m]=a(c,l,!r),f=d,d+=Math.hypot(t[p-1][0]-t[p][0],t[p-1][1]-t[p][1]),n.vertices[o.vertices++]=i[0],n.vertices[o.vertices++]=i[1],n.vertices[o.vertices++]=-f,n.vertices[o.vertices++]=i[0],n.vertices[o.vertices++]=i[1],n.vertices[o.vertices++]=f,n.vertices[o.vertices++]=u[0],n.vertices[o.vertices++]=u[1],n.vertices[o.vertices++]=-d,n.vertices[o.vertices++]=u[0],n.vertices[o.vertices++]=u[1],n.vertices[o.vertices++]=d,n.extrusion[o.extrusion++]=h,n.extrusion[o.extrusion++]=m,n.extrusion[o.extrusion++]=-h,n.extrusion[o.extrusion++]=-m,n.extrusion[o.extrusion++]=h,n.extrusion[o.extrusion++]=m,n.extrusion[o.extrusion++]=-h,n.extrusion[o.extrusion++]=-m;if(n.vertices[o.vertices++]=u[0],n.vertices[o.vertices++]=u[1],n.vertices[o.vertices++]=d,n.extrusion[o.extrusion++]=-h,n.extrusion[o.extrusion++]=-m,void 0!==n.offsets&&void 0!==e.offsets){const t=e.offsets;let r,s=t[0];n.offsets[o.offsets++]=s[0],n.offsets[o.offsets++]=s[1];for(let e=1;e<t.length;e++)s=t[e],r=t[e-1],n.offsets[o.offsets++]=r[0],n.offsets[o.offsets++]=r[1],n.offsets[o.offsets++]=r[0],n.offsets[o.offsets++]=r[1],n.offsets[o.offsets++]=s[0],n.offsets[o.offsets++]=s[1],n.offsets[o.offsets++]=s[0],n.offsets[o.offsets++]=s[1];n.offsets[o.offsets++]=s[0],n.offsets[o.offsets++]=s[1]}if(void 0!==n.data&&void 0!==e.data){const t=e.data;let r,s=t[0];n.data[o.data++]=s;for(let e=1;e<t.length;e++)s=t[e],r=t[e-1],n.data[o.data++]=r,n.data[o.data++]=r,n.data[o.data++]=s,n.data[o.data++]=s;n.data[o.data++]=s}if(void 0!==n.zoom&&void 0!==e.zoom)for(let a=0;a<4*t.length-2;a++)n.zoom[o.zoom++]=e.zoom}),n}})})();
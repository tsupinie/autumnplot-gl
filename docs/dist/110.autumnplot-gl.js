!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.apgl=e():t.apgl=e()}(this,(()=>(()=>{"use strict";function t(t,e,r){for(var n=1,o=r;t%o!=0||e%o!=0;)n+=1,o/=2;return n}const e=Symbol("Comlink.proxy"),r=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.thrown"),a=t=>"object"==typeof t&&null!==t||"function"==typeof t,s=new Map([["proxy",{canHandle:t=>a(t)&&t[e],serialize(t){const{port1:e,port2:r}=new MessageChannel;return i(t,e),[r,[r]]},deserialize:t=>(t.start(),l(t,[],undefined))}],["throw",{canHandle:t=>a(t)&&o in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function i(t,r=self){r.addEventListener("message",(function n(a){if(!a||!a.data)return;const{id:s,type:u,path:l}=Object.assign({path:[]},a.data),f=(a.data.argumentList||[]).map(v);let p;try{const r=l.slice(0,-1).reduce(((t,e)=>t[e]),t),n=l.reduce(((t,e)=>t[e]),t);switch(u){case"GET":p=n;break;case"SET":r[l.slice(-1)[0]]=v(a.data.value),p=!0;break;case"APPLY":p=n.apply(r,f);break;case"CONSTRUCT":p=function(t){return Object.assign(t,{[e]:!0})}(new n(...f));break;case"ENDPOINT":{const{port1:e,port2:r}=new MessageChannel;i(t,r),p=function(t,e){return d.set(t,e),t}(e,[e])}break;case"RELEASE":p=void 0;break;default:return}}catch(t){p={value:t,[o]:0}}Promise.resolve(p).catch((t=>({value:t,[o]:0}))).then((t=>{const[e,o]=h(t);r.postMessage(Object.assign(Object.assign({},e),{id:s}),o),"RELEASE"===u&&(r.removeEventListener("message",n),c(r))}))})),r.start&&r.start()}function c(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t){if(t)throw new Error("Proxy has been released and is not useable")}function l(t,e=[],o=function(){}){let a=!1;const s=new Proxy(o,{get(r,o){if(u(a),o===n)return()=>p(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{c(t),a=!0}));if("then"===o){if(0===e.length)return{then:()=>s};const r=p(t,{type:"GET",path:e.map((t=>t.toString()))}).then(v);return r.then.bind(r)}return l(t,[...e,o])},set(r,n,o){u(a);const[s,i]=h(o);return p(t,{type:"SET",path:[...e,n].map((t=>t.toString())),value:s},i).then(v)},apply(n,o,s){u(a);const i=e[e.length-1];if(i===r)return p(t,{type:"ENDPOINT"}).then(v);if("bind"===i)return l(t,e.slice(0,-1));const[c,d]=f(s);return p(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:c},d).then(v)},construct(r,n){u(a);const[o,s]=f(n);return p(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:o},s).then(v)}});return s}function f(t){const e=t.map(h);return[e.map((t=>t[0])),(r=e.map((t=>t[1])),Array.prototype.concat.apply([],r))];var r}const d=new WeakMap;function h(t){for(const[e,r]of s)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},d.get(t)||[]]}function v(t){switch(t.type){case"HANDLER":return s.get(t.name).deserialize(t.value);case"RAW":return t.value}}function p(t,e,r){return new Promise((n=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(r){r.data&&r.data.id&&r.data.id===o&&(t.removeEventListener("message",e),n(r.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),r)}))}var m=function(){function t(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(e,")"));if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return t.prototype.toMercatorCoord=function(){return{x:(e=this.lng,(180+e)/360),y:(t=this.lat,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)};var t,e},t}(),y=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return s};return i({makeBBElements:function(e,r,n,o,a,s){for(var i=Math.log2(a),c=Math.max(i+1-s,0),u=Math.pow(2,c),l=Math.floor((n-1)/u)+1,f=Math.floor((o-1)/u)+1,d=l*f*6*2,h=new Float32Array(l*f*6*3),v=new Float32Array(d),p=0,y=0,g=0;g<o;g++)for(var x=0;x<n;x++){var E=g*n+x,b=e[E],w=r[E],M=t(g,x,a);if(!(M>s)){for(var A=new m(w,b).toMercatorCoord(),S=0;S<6;S++){var j=Math.max(0,Math.min(S-1,3));h[p+3*S+0]=A.x,h[p+3*S+1]=A.y,h[p+3*S+2]=4*M+j,v[y+2*S+0]=x/(n-1),v[y+2*S+1]=g/(o-1)}p+=18,y+=12}}return{pts:h,tex_coords:v}},makeDomainVerticesAndTexCoords:function(t,e,r,n,o,a){for(var s=new Float32Array(4*(r-1)*(n+1)).fill(0),i=new Float32Array(4*(r-1)*(n+1)).fill(0),c=new Float32Array(2*(r-1)*(n+1)).fill(0),u=0,l=0,f=0;f<r-1;f++)for(var d=0;d<n;d++){var h=f+d*r,v=new m(e[h],t[h]).toMercatorCoord(),p=new m(e[h+1],t[h+1]).toMercatorCoord(),y=f/(r-1)*(1-2*o)+o,g=(f+1)/(r-1)*(1-2*o)+o,x=d/(n-1)*(1-2*a)+a;0==d&&(s[u]=v.x,s[u+1]=v.y,u+=2,i[l]=y,i[l+1]=x,l+=2),s[u]=v.x,s[u+1]=v.y,s[u+2]=p.x,s[u+3]=p.y,u+=4,i[l]=y,i[l+1]=x,i[l+2]=g,i[l+3]=x,l+=4,d==n-1&&(s[u]=p.x,s[u+1]=p.y,u+=2,i[l]=g,i[l+1]=x,l+=2)}var E=0;for(f=0;f<r-1;f++)for(d=0;d<n-1;d++){var b=0==d?2*(E+1):2*E,w=s[b],M=s[b+1],A=s[b+2],S=s[b+3],j=s[b+4],L=s[b+5],k=s[b+6],O=s[b+7],P=.5*Math.abs(w*(S-L)+A*(L-M)+j*(M-S)+k*(L-S)+j*(S-O)+A*(O-L));0==d&&(c[E]=P,E+=1),c[E]=P,c[E+1]=P,E+=2,d==n-2&&(c[E]=P,c[E+1]=P,c[E+2]=P,E+=3)}return{vertices:s,tex_coords:i,grid_cell_size:c}},makePolyLines:function(t){var e=Object.fromEntries(Object.entries(t[0]).map((function(t){var e=y(t,2),r=e[0],n=e[1];return[r,void 0===n.length?1:void 0===n[0].length?n.length:n[0].length]})));e.extrusion=2;var r=6*(t.map((function(t){return t.verts.length})).reduce((function(t,e){return t+e}))-t.length),n=Object.fromEntries(Object.entries(e).map((function(t){var e=y(t,2),n=e[0],o=e[1];return[n,r*o]}))),o={verts:new Float32Array(n.verts),origin:new Float32Array(n.origin),extrusion:new Float32Array(n.extrusion),zoom:new Float32Array(n.zoom),texcoords:new Float32Array(n.texcoords)},a=Object.fromEntries(Object.keys(n).map((function(t){return[t,0]}))),s=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],o=Math.hypot(r,n);return[n/o,-r/o]};return t.forEach((function(t){var r,n,i,c=t.verts,u=t.texcoords,l=a.verts,f=c[0],d=c[1],h=u[0],v=(u[1],y(s(f,d),2)),p=v[0],m=v[1];o.verts[l+0]=f[0],o.verts[l+1]=f[1],o.texcoords[l+0]=h[0],o.texcoords[l+1]=h[1],o.extrusion[l+0]=p,o.extrusion[l+1]=m;for(var g=1;g<c.length;g++)f=c[g],n=c[g-1],h=u[g],i=u[g-1],p=(r=y(s(n,f),2))[0],m=r[1],l=a.verts+(1+4*(g-1))*e.verts,o.verts[l+0]=n[0],o.verts[l+1]=n[1],o.verts[l+2]=n[0],o.verts[l+3]=n[1],o.verts[l+4]=f[0],o.verts[l+5]=f[1],o.verts[l+6]=f[0],o.verts[l+7]=f[1],o.texcoords[l+0]=i[0],o.texcoords[l+1]=i[1],o.texcoords[l+2]=i[0],o.texcoords[l+3]=i[1],o.texcoords[l+4]=h[0],o.texcoords[l+5]=h[1],o.texcoords[l+6]=h[0],o.texcoords[l+7]=h[1],o.extrusion[l+0]=p,o.extrusion[l+1]=m,o.extrusion[l+2]=-p,o.extrusion[l+3]=-m,o.extrusion[l+4]=p,o.extrusion[l+5]=m,o.extrusion[l+6]=-p,o.extrusion[l+7]=-m;o.verts[l+8]=f[0],o.verts[l+9]=f[1],o.texcoords[l+8]=h[0],o.texcoords[l+9]=h[1],o.extrusion[l+8]=-p,o.extrusion[l+9]=-m;var x=function(e){t.origin.forEach((function(t,r){o.origin[a.origin+e+r]=t}))};for(g=0;g<6*(c.length-1)*e.origin;g+=e.origin)x(g);for(g=0;g<6*(c.length-1)*e.zoom;g+=e.zoom)o.zoom[a.zoom+g]=t.zoom;Object.keys(a).forEach((function(t){a[t]+=6*(c.length-1)*e[t]}))})),o}}),{}})()));
//# sourceMappingURL=110.autumnplot-gl.js.map
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.apgl=e():t.apgl=e()}(this,(()=>(()=>{"use strict";const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),n=Symbol("Comlink.thrown"),o=t=>"object"==typeof t&&null!==t||"function"==typeof t,a=new Map([["proxy",{canHandle:e=>o(e)&&e[t],serialize(t){const{port1:e,port2:r}=new MessageChannel;return s(t,e),[r,[r]]},deserialize:t=>(t.start(),u(t,[],undefined))}],["throw",{canHandle:t=>o(t)&&n in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function s(e,r=self){r.addEventListener("message",(function o(a){if(!a||!a.data)return;const{id:c,type:u,path:l}=Object.assign({path:[]},a.data),d=(a.data.argumentList||[]).map(p);let m;try{const r=l.slice(0,-1).reduce(((t,e)=>t[e]),e),n=l.reduce(((t,e)=>t[e]),e);switch(u){case"GET":m=n;break;case"SET":r[l.slice(-1)[0]]=p(a.data.value),m=!0;break;case"APPLY":m=n.apply(r,d);break;case"CONSTRUCT":m=function(e){return Object.assign(e,{[t]:!0})}(new n(...d));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;s(e,r),m=function(t,e){return f.set(t,e),t}(t,[t])}break;case"RELEASE":m=void 0;break;default:return}}catch(t){m={value:t,[n]:0}}Promise.resolve(m).catch((t=>({value:t,[n]:0}))).then((t=>{const[e,n]=h(t);r.postMessage(Object.assign(Object.assign({},e),{id:c}),n),"RELEASE"===u&&(r.removeEventListener("message",o),i(r))}))})),r.start&&r.start()}function i(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function c(t){if(t)throw new Error("Proxy has been released and is not useable")}function u(t,n=[],o=function(){}){let a=!1;const s=new Proxy(o,{get(e,o){if(c(a),o===r)return()=>d(t,{type:"RELEASE",path:n.map((t=>t.toString()))}).then((()=>{i(t),a=!0}));if("then"===o){if(0===n.length)return{then:()=>s};const e=d(t,{type:"GET",path:n.map((t=>t.toString()))}).then(p);return e.then.bind(e)}return u(t,[...n,o])},set(e,r,o){c(a);const[s,i]=h(o);return d(t,{type:"SET",path:[...n,r].map((t=>t.toString())),value:s},i).then(p)},apply(r,o,s){c(a);const i=n[n.length-1];if(i===e)return d(t,{type:"ENDPOINT"}).then(p);if("bind"===i)return u(t,n.slice(0,-1));const[f,h]=l(s);return d(t,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:f},h).then(p)},construct(e,r){c(a);const[o,s]=l(r);return d(t,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:o},s).then(p)}});return s}function l(t){const e=t.map(h);return[e.map((t=>t[0])),(r=e.map((t=>t[1])),Array.prototype.concat.apply([],r))];var r}const f=new WeakMap;function h(t){for(const[e,r]of a)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},f.get(t)||[]]}function p(t){switch(t.type){case"HANDLER":return a.get(t.name).deserialize(t.value);case"RAW":return t.value}}function d(t,e,r){return new Promise((n=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(r){r.data&&r.data.id&&r.data.id===o&&(t.removeEventListener("message",e),n(r.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),r)}))}var m=function(){function t(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(e,")"));if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return t.prototype.toMercatorCoord=function(){return{x:(e=this.lng,(180+e)/360),y:(t=this.lat,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)};var t,e},t}(),v=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return s},g=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,a=e.length;o<a;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};return s({makeBarbElements:function(t,e,r,n,o,a){var s=a.BARB_WIDTH,i=a.BARB_TEX_WIDTH,c=a.BARB_HEIGHT,u=a.BARB_TEX_HEIGHT,l=a.BARB_TEX_WRAP,f=t.length,h=e.length,p=f*h*6*2,d=new Float32Array(f*h*6*3),v=new Float32Array(p),g=new Float32Array(p),y=0,x=0,E=s/i,b=c/u;return t.forEach((function(t,a){e.forEach((function(e,s){for(var i=function(t,e,r){for(var n=1,o=r;t%o!=0||e%o!=0;)n+=1,o/=2;return n}(a,s,o),c=r[a*h+s],u=n[a*h+s],f=5*Math.round(Math.hypot(c,u)/5),p=90-180*Math.atan2(-u,-c)/Math.PI,w=new m(e,t).toMercatorCoord(),A=0;A<6;A++){var M=Math.max(0,Math.min(A-1,3));d[y+3*A+0]=w.x,d[y+3*A+1]=w.y,d[y+3*A+2]=i,v[x+2*A+0]=M,v[x+2*A+1]=p}var S=f%l/5,j=Math.floor(f/l);g[x+0]=S*E,g[x+1]=j*b,g[x+2]=S*E,g[x+3]=j*b,g[x+4]=(S+1)*E,g[x+5]=j*b,g[x+6]=S*E,g[x+7]=(j+1)*b,g[x+8]=(S+1)*E,g[x+9]=(j+1)*b,g[x+10]=(S+1)*E,g[x+11]=(j+1)*b,y+=18,x+=12}))})),{pts:d,offset:v,tex_coords:g}},makeDomainVerticesAndTexCoords:function(t,e,r,n){var o=e.length,a=o-1,s=g([],v(t),!1).map((function(t){return[{lng:e[0],lat:t},{lng:e[a],lat:t}]})).flat().map((function(t){return new m(t.lng,t.lat).toMercatorCoord()})).map((function(t){return[t.x,t.y]})).flat(),i=g([],v(t),!1).map((function(t,e){return[{s:(e+.5)/n,r:.505/(r+1.07)},{s:(e+.5)/n,r:(o+.505)/(r+1.07)}]})).flat().map((function(t){return[t.r,t.s]})).flat();return{vertices:new Float32Array(s),tex_coords:new Float32Array(i)}},makePolyLines:function(t){var e=Object.fromEntries(Object.entries(t[0]).map((function(t){var e=v(t,2),r=e[0],n=e[1];return[r,void 0===n.length?1:void 0===n[0].length?n.length:n[0].length]})));e.extrusion=2;var r=6*(t.map((function(t){return t.verts.length})).reduce((function(t,e){return t+e}))-t.length),n=Object.fromEntries(Object.entries(e).map((function(t){var e=v(t,2),n=e[0],o=e[1];return[n,r*o]}))),o={verts:new Float32Array(n.verts),origin:new Float32Array(n.origin),extrusion:new Float32Array(n.extrusion),zoom:new Float32Array(n.zoom),texcoords:new Float32Array(n.texcoords)},a=Object.fromEntries(Object.keys(n).map((function(t){return[t,0]}))),s=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],o=Math.hypot(r,n);return[n/o,-r/o]};return t.forEach((function(t){var r,n,i,c=t.verts,u=t.texcoords,l=a.verts,f=c[0],h=c[1],p=u[0],d=(u[1],v(s(f,h),2)),m=d[0],g=d[1];o.verts[l+0]=f[0],o.verts[l+1]=f[1],o.texcoords[l+0]=p[0],o.texcoords[l+1]=p[1],o.extrusion[l+0]=m,o.extrusion[l+1]=g;for(var y=1;y<c.length;y++)f=c[y],n=c[y-1],p=u[y],i=u[y-1],m=(r=v(s(n,f),2))[0],g=r[1],l=a.verts+(1+4*(y-1))*e.verts,o.verts[l+0]=n[0],o.verts[l+1]=n[1],o.verts[l+2]=n[0],o.verts[l+3]=n[1],o.verts[l+4]=f[0],o.verts[l+5]=f[1],o.verts[l+6]=f[0],o.verts[l+7]=f[1],o.texcoords[l+0]=i[0],o.texcoords[l+1]=i[1],o.texcoords[l+2]=i[0],o.texcoords[l+3]=i[1],o.texcoords[l+4]=p[0],o.texcoords[l+5]=p[1],o.texcoords[l+6]=p[0],o.texcoords[l+7]=p[1],o.extrusion[l+0]=m,o.extrusion[l+1]=g,o.extrusion[l+2]=-m,o.extrusion[l+3]=-g,o.extrusion[l+4]=m,o.extrusion[l+5]=g,o.extrusion[l+6]=-m,o.extrusion[l+7]=-g;o.verts[l+8]=f[0],o.verts[l+9]=f[1],o.texcoords[l+8]=p[0],o.texcoords[l+9]=p[1],o.extrusion[l+8]=-m,o.extrusion[l+9]=-g;var x=function(e){t.origin.forEach((function(t,r){o.origin[a.origin+e+r]=t}))};for(y=0;y<6*(c.length-1)*e.origin;y+=e.origin)x(y);for(y=0;y<6*(c.length-1)*e.zoom;y+=e.zoom)o.zoom[a.zoom+y]=t.zoom;Object.keys(a).forEach((function(t){a[t]+=6*(c.length-1)*e[t]}))})),o}}),{}})()));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxHQUFLRyxFQUFRLEdBQUloQixFQUFlLFVBQUVhLEVBQVUsR0FBS0csRUFBUSxHQUNwRmhCLEVBQWUsVUFBRWEsRUFBVSxJQUFNSSxFQUFPakIsRUFBZSxVQUFFYSxFQUFVLElBQU1LLEUsZUFFaEVDLEdBQ0xWLEVBQWEsT0FBRWxELFNBQVEsU0FBQzZCLEVBQUlnQyxHQUN4QnBCLEVBQVksT0FBRUMsRUFBYSxPQUFJa0IsRUFBTUMsR0FBT2hDLENBQ2hELEcsRUFISixJQUFTK0IsRUFBTSxFQUFHQSxFQUEyQixHQUFwQmxDLEVBQU1uRixPQUFTLEdBQVN5RixFQUEwQixPQUFHNEIsR0FBTzVCLEVBQTBCLE8sRUFBdEc0QixHQU1ULElBQVNBLEVBQU0sRUFBR0EsRUFBMkIsR0FBcEJsQyxFQUFNbkYsT0FBUyxHQUFTeUYsRUFBd0IsS0FBRzRCLEdBQU81QixFQUF3QixLQUN2R1MsRUFBVSxLQUFFQyxFQUFXLEtBQUlrQixHQUFPVixFQUFXLEtBR2pEN0osT0FBT3NKLEtBQUtELEdBQU0xQyxTQUFRLFNBQUFtQyxHQUN0Qk8sRUFBS1AsSUFBMkIsR0FBcEJULEVBQU1uRixPQUFTLEdBQVN5RixFQUFrQkcsRUFDMUQsR0FDSixJQUVPTSxDQUNYLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hcGdsL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9hcGdsLy4vbm9kZV9tb2R1bGVzL2NvbWxpbmsvZGlzdC9lc20vY29tbGluay5tanMiLCJ3ZWJwYWNrOi8vYXBnbC8uL3NyYy9NYXAudHMiLCJ3ZWJwYWNrOi8vYXBnbC8uL3NyYy9QbG90TGF5ZXIud29ya2VyLnRzIiwid2VicGFjazovL2FwZ2wvLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiYXBnbFwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJhcGdsXCJdID0gZmFjdG9yeSgpO1xufSkodGhpcywgKCkgPT4ge1xucmV0dXJuICIsIi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IHByb3h5TWFya2VyID0gU3ltYm9sKFwiQ29tbGluay5wcm94eVwiKTtcclxuY29uc3QgY3JlYXRlRW5kcG9pbnQgPSBTeW1ib2woXCJDb21saW5rLmVuZHBvaW50XCIpO1xyXG5jb25zdCByZWxlYXNlUHJveHkgPSBTeW1ib2woXCJDb21saW5rLnJlbGVhc2VQcm94eVwiKTtcclxuY29uc3QgdGhyb3dNYXJrZXIgPSBTeW1ib2woXCJDb21saW5rLnRocm93blwiKTtcclxuY29uc3QgaXNPYmplY3QgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwpIHx8IHR5cGVvZiB2YWwgPT09IFwiZnVuY3Rpb25cIjtcclxuLyoqXHJcbiAqIEludGVybmFsIHRyYW5zZmVyIGhhbmRsZSB0byBoYW5kbGUgb2JqZWN0cyBtYXJrZWQgdG8gcHJveHkuXHJcbiAqL1xyXG5jb25zdCBwcm94eVRyYW5zZmVySGFuZGxlciA9IHtcclxuICAgIGNhbkhhbmRsZTogKHZhbCkgPT4gaXNPYmplY3QodmFsKSAmJiB2YWxbcHJveHlNYXJrZXJdLFxyXG4gICAgc2VyaWFsaXplKG9iaikge1xyXG4gICAgICAgIGNvbnN0IHsgcG9ydDEsIHBvcnQyIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuICAgICAgICBleHBvc2Uob2JqLCBwb3J0MSk7XHJcbiAgICAgICAgcmV0dXJuIFtwb3J0MiwgW3BvcnQyXV07XHJcbiAgICB9LFxyXG4gICAgZGVzZXJpYWxpemUocG9ydCkge1xyXG4gICAgICAgIHBvcnQuc3RhcnQoKTtcclxuICAgICAgICByZXR1cm4gd3JhcChwb3J0KTtcclxuICAgIH0sXHJcbn07XHJcbi8qKlxyXG4gKiBJbnRlcm5hbCB0cmFuc2ZlciBoYW5kbGVyIHRvIGhhbmRsZSB0aHJvd24gZXhjZXB0aW9ucy5cclxuICovXHJcbmNvbnN0IHRocm93VHJhbnNmZXJIYW5kbGVyID0ge1xyXG4gICAgY2FuSGFuZGxlOiAodmFsdWUpID0+IGlzT2JqZWN0KHZhbHVlKSAmJiB0aHJvd01hcmtlciBpbiB2YWx1ZSxcclxuICAgIHNlcmlhbGl6ZSh7IHZhbHVlIH0pIHtcclxuICAgICAgICBsZXQgc2VyaWFsaXplZDtcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkID0ge1xyXG4gICAgICAgICAgICAgICAgaXNFcnJvcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogdmFsdWUubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWNrOiB2YWx1ZS5zdGFjayxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkID0geyBpc0Vycm9yOiBmYWxzZSwgdmFsdWUgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtzZXJpYWxpemVkLCBbXV07XHJcbiAgICB9LFxyXG4gICAgZGVzZXJpYWxpemUoc2VyaWFsaXplZCkge1xyXG4gICAgICAgIGlmIChzZXJpYWxpemVkLmlzRXJyb3IpIHtcclxuICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3Ioc2VyaWFsaXplZC52YWx1ZS5tZXNzYWdlKSwgc2VyaWFsaXplZC52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IHNlcmlhbGl6ZWQudmFsdWU7XHJcbiAgICB9LFxyXG59O1xyXG4vKipcclxuICogQWxsb3dzIGN1c3RvbWl6aW5nIHRoZSBzZXJpYWxpemF0aW9uIG9mIGNlcnRhaW4gdmFsdWVzLlxyXG4gKi9cclxuY29uc3QgdHJhbnNmZXJIYW5kbGVycyA9IG5ldyBNYXAoW1xyXG4gICAgW1wicHJveHlcIiwgcHJveHlUcmFuc2ZlckhhbmRsZXJdLFxyXG4gICAgW1widGhyb3dcIiwgdGhyb3dUcmFuc2ZlckhhbmRsZXJdLFxyXG5dKTtcclxuZnVuY3Rpb24gZXhwb3NlKG9iaiwgZXAgPSBzZWxmKSB7XHJcbiAgICBlcC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbiBjYWxsYmFjayhldikge1xyXG4gICAgICAgIGlmICghZXYgfHwgIWV2LmRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IGlkLCB0eXBlLCBwYXRoIH0gPSBPYmplY3QuYXNzaWduKHsgcGF0aDogW10gfSwgZXYuZGF0YSk7XHJcbiAgICAgICAgY29uc3QgYXJndW1lbnRMaXN0ID0gKGV2LmRhdGEuYXJndW1lbnRMaXN0IHx8IFtdKS5tYXAoZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgbGV0IHJldHVyblZhbHVlO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHBhdGguc2xpY2UoMCwgLTEpLnJlZHVjZSgob2JqLCBwcm9wKSA9PiBvYmpbcHJvcF0sIG9iaik7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhd1ZhbHVlID0gcGF0aC5yZWR1Y2UoKG9iaiwgcHJvcCkgPT4gb2JqW3Byb3BdLCBvYmopO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJHRVRcIiAvKiBHRVQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJhd1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJTRVRcIiAvKiBTRVQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRbcGF0aC5zbGljZSgtMSlbMF1dID0gZnJvbVdpcmVWYWx1ZShldi5kYXRhLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBUFBMWVwiIC8qIEFQUExZICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSByYXdWYWx1ZS5hcHBseShwYXJlbnQsIGFyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkNPTlNUUlVDVFwiIC8qIENPTlNUUlVDVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IHJhd1ZhbHVlKC4uLmFyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcHJveHkodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJFTkRQT0lOVFwiIC8qIEVORFBPSU5UICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBwb3J0MSwgcG9ydDIgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvc2Uob2JqLCBwb3J0Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJhbnNmZXIocG9ydDEsIFtwb3J0MV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoICh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHsgdmFsdWUsIFt0aHJvd01hcmtlcl06IDAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHJldHVyblZhbHVlKVxyXG4gICAgICAgICAgICAuY2F0Y2goKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKHJldHVyblZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IFt3aXJlVmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmV0dXJuVmFsdWUpO1xyXG4gICAgICAgICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHdpcmVWYWx1ZSksIHsgaWQgfSksIHRyYW5zZmVyYWJsZXMpO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLykge1xyXG4gICAgICAgICAgICAgICAgLy8gZGV0YWNoIGFuZCBkZWFjdGl2ZSBhZnRlciBzZW5kaW5nIHJlbGVhc2UgcmVzcG9uc2UgYWJvdmUuXHJcbiAgICAgICAgICAgICAgICBlcC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBjbG9zZUVuZFBvaW50KGVwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoZXAuc3RhcnQpIHtcclxuICAgICAgICBlcC5zdGFydCgpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpIHtcclxuICAgIHJldHVybiBlbmRwb2ludC5jb25zdHJ1Y3Rvci5uYW1lID09PSBcIk1lc3NhZ2VQb3J0XCI7XHJcbn1cclxuZnVuY3Rpb24gY2xvc2VFbmRQb2ludChlbmRwb2ludCkge1xyXG4gICAgaWYgKGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpKVxyXG4gICAgICAgIGVuZHBvaW50LmNsb3NlKCk7XHJcbn1cclxuZnVuY3Rpb24gd3JhcChlcCwgdGFyZ2V0KSB7XHJcbiAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIFtdLCB0YXJnZXQpO1xyXG59XHJcbmZ1bmN0aW9uIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUmVsZWFzZWQpIHtcclxuICAgIGlmIChpc1JlbGVhc2VkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJveHkgaGFzIGJlZW4gcmVsZWFzZWQgYW5kIGlzIG5vdCB1c2VhYmxlXCIpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZVByb3h5KGVwLCBwYXRoID0gW10sIHRhcmdldCA9IGZ1bmN0aW9uICgpIHsgfSkge1xyXG4gICAgbGV0IGlzUHJveHlSZWxlYXNlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgcHJveHkgPSBuZXcgUHJveHkodGFyZ2V0LCB7XHJcbiAgICAgICAgZ2V0KF90YXJnZXQsIHByb3ApIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgaWYgKHByb3AgPT09IHJlbGVhc2VQcm94eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlJFTEVBU0VcIiAvKiBSRUxFQVNFICovLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzUHJveHlSZWxlYXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSBcInRoZW5cIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdGhlbjogKCkgPT4gcHJveHkgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIiAvKiBHRVQgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIudGhlbi5iaW5kKHIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgWy4uLnBhdGgsIHByb3BdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldChfdGFyZ2V0LCBwcm9wLCByYXdWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICAvLyBGSVhNRTogRVM2IFByb3h5IEhhbmRsZXIgYHNldGAgbWV0aG9kcyBhcmUgc3VwcG9zZWQgdG8gcmV0dXJuIGFcclxuICAgICAgICAgICAgLy8gYm9vbGVhbi4gVG8gc2hvdyBnb29kIHdpbGwsIHdlIHJldHVybiB0cnVlIGFzeW5jaHJvbm91c2x5IMKvXFxfKOODhClfL8KvXHJcbiAgICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgdHJhbnNmZXJhYmxlc10gPSB0b1dpcmVWYWx1ZShyYXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlNFVFwiIC8qIFNFVCAqLyxcclxuICAgICAgICAgICAgICAgIHBhdGg6IFsuLi5wYXRoLCBwcm9wXS5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFwcGx5KF90YXJnZXQsIF90aGlzQXJnLCByYXdBcmd1bWVudExpc3QpIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgY29uc3QgbGFzdCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgaWYgKGxhc3QgPT09IGNyZWF0ZUVuZHBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiRU5EUE9JTlRcIiAvKiBFTkRQT0lOVCAqLyxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gV2UganVzdCBwcmV0ZW5kIHRoYXQgYGJpbmQoKWAgZGlkbuKAmXQgaGFwcGVuLlxyXG4gICAgICAgICAgICBpZiAobGFzdCA9PT0gXCJiaW5kXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgcGF0aC5zbGljZSgwLCAtMSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJBUFBMWVwiIC8qIEFQUExZICovLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudExpc3QsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb25zdHJ1Y3QoX3RhcmdldCwgcmF3QXJndW1lbnRMaXN0KSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJDT05TVFJVQ1RcIiAvKiBDT05TVFJVQ1QgKi8sXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50TGlzdCxcclxuICAgICAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcHJveHk7XHJcbn1cclxuZnVuY3Rpb24gbXlGbGF0KGFycikge1xyXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFycik7XHJcbn1cclxuZnVuY3Rpb24gcHJvY2Vzc0FyZ3VtZW50cyhhcmd1bWVudExpc3QpIHtcclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IGFyZ3VtZW50TGlzdC5tYXAodG9XaXJlVmFsdWUpO1xyXG4gICAgcmV0dXJuIFtwcm9jZXNzZWQubWFwKCh2KSA9PiB2WzBdKSwgbXlGbGF0KHByb2Nlc3NlZC5tYXAoKHYpID0+IHZbMV0pKV07XHJcbn1cclxuY29uc3QgdHJhbnNmZXJDYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmZ1bmN0aW9uIHRyYW5zZmVyKG9iaiwgdHJhbnNmZXJzKSB7XHJcbiAgICB0cmFuc2ZlckNhY2hlLnNldChvYmosIHRyYW5zZmVycyk7XHJcbiAgICByZXR1cm4gb2JqO1xyXG59XHJcbmZ1bmN0aW9uIHByb3h5KG9iaikge1xyXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ob2JqLCB7IFtwcm94eU1hcmtlcl06IHRydWUgfSk7XHJcbn1cclxuZnVuY3Rpb24gd2luZG93RW5kcG9pbnQodywgY29udGV4dCA9IHNlbGYsIHRhcmdldE9yaWdpbiA9IFwiKlwiKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHBvc3RNZXNzYWdlOiAobXNnLCB0cmFuc2ZlcmFibGVzKSA9PiB3LnBvc3RNZXNzYWdlKG1zZywgdGFyZ2V0T3JpZ2luLCB0cmFuc2ZlcmFibGVzKSxcclxuICAgICAgICBhZGRFdmVudExpc3RlbmVyOiBjb250ZXh0LmFkZEV2ZW50TGlzdGVuZXIuYmluZChjb250ZXh0KSxcclxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBjb250ZXh0LnJlbW92ZUV2ZW50TGlzdGVuZXIuYmluZChjb250ZXh0KSxcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdG9XaXJlVmFsdWUodmFsdWUpIHtcclxuICAgIGZvciAoY29uc3QgW25hbWUsIGhhbmRsZXJdIG9mIHRyYW5zZmVySGFuZGxlcnMpIHtcclxuICAgICAgICBpZiAoaGFuZGxlci5jYW5IYW5kbGUodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtzZXJpYWxpemVkVmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gaGFuZGxlci5zZXJpYWxpemUodmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiSEFORExFUlwiIC8qIEhBTkRMRVIgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc2VyaWFsaXplZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRyYW5zZmVyYWJsZXMsXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiUkFXXCIgLyogUkFXICovLFxyXG4gICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRyYW5zZmVyQ2FjaGUuZ2V0KHZhbHVlKSB8fCBbXSxcclxuICAgIF07XHJcbn1cclxuZnVuY3Rpb24gZnJvbVdpcmVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgc3dpdGNoICh2YWx1ZS50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBcIkhBTkRMRVJcIiAvKiBIQU5ETEVSICovOlxyXG4gICAgICAgICAgICByZXR1cm4gdHJhbnNmZXJIYW5kbGVycy5nZXQodmFsdWUubmFtZSkuZGVzZXJpYWxpemUodmFsdWUudmFsdWUpO1xyXG4gICAgICAgIGNhc2UgXCJSQVdcIiAvKiBSQVcgKi86XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS52YWx1ZTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBtc2csIHRyYW5zZmVycykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICBlcC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbiBsKGV2KSB7XHJcbiAgICAgICAgICAgIGlmICghZXYuZGF0YSB8fCAhZXYuZGF0YS5pZCB8fCBldi5kYXRhLmlkICE9PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGwpO1xyXG4gICAgICAgICAgICByZXNvbHZlKGV2LmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChlcC5zdGFydCkge1xyXG4gICAgICAgICAgICBlcC5zdGFydCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHsgaWQgfSwgbXNnKSwgdHJhbnNmZXJzKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHtcclxuICAgIHJldHVybiBuZXcgQXJyYXkoNClcclxuICAgICAgICAuZmlsbCgwKVxyXG4gICAgICAgIC5tYXAoKCkgPT4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpLnRvU3RyaW5nKDE2KSlcclxuICAgICAgICAuam9pbihcIi1cIik7XHJcbn1cblxuZXhwb3J0IHsgY3JlYXRlRW5kcG9pbnQsIGV4cG9zZSwgcHJveHksIHByb3h5TWFya2VyLCByZWxlYXNlUHJveHksIHRyYW5zZmVyLCB0cmFuc2ZlckhhbmRsZXJzLCB3aW5kb3dFbmRwb2ludCwgd3JhcCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbGluay5tanMubWFwXG4iLCJcbmltcG9ydCBtYXBib3hnbCBmcm9tICdtYXBib3gtZ2wnO1xuaW1wb3J0IG1hcGxpYnJlZ2wgZnJvbSAnbWFwbGlicmUtZ2wnO1xuXG50eXBlIE1hcFR5cGUgPSBtYXBib3hnbC5NYXAgfCBtYXBsaWJyZWdsLk1hcDtcblxuZnVuY3Rpb24gbWVyY2F0b3JYZnJvbUxuZyhsbmc6IG51bWJlcikge1xuICAgIHJldHVybiAoMTgwICsgbG5nKSAvIDM2MDtcbn1cblxuZnVuY3Rpb24gbWVyY2F0b3JZZnJvbUxhdChsYXQ6IG51bWJlcikge1xuICAgIHJldHVybiAoMTgwIC0gKDE4MCAvIE1hdGguUEkgKiBNYXRoLmxvZyhNYXRoLnRhbihNYXRoLlBJIC8gNCArIGxhdCAqIE1hdGguUEkgLyAzNjApKSkpIC8gMzYwO1xufVxuXG4vKipcbiAqIEEgYExuZ0xhdGAgb2JqZWN0IHJlcHJlc2VudHMgYSBnaXZlbiBsb25naXR1ZGUgYW5kIGxhdGl0dWRlIGNvb3JkaW5hdGUsIG1lYXN1cmVkIGluIGRlZ3JlZXMuXG4gKiBUaGVzZSBjb29yZGluYXRlcyBhcmUgYmFzZWQgb24gdGhlIFtXR1M4NCAoRVBTRzo0MzI2KSBzdGFuZGFyZF0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvV29ybGRfR2VvZGV0aWNfU3lzdGVtI1dHUzg0KS5cbiAqXG4gKiBNYXBMaWJyZSBHTCB1c2VzIGxvbmdpdHVkZSwgbGF0aXR1ZGUgY29vcmRpbmF0ZSBvcmRlciAoYXMgb3Bwb3NlZCB0byBsYXRpdHVkZSwgbG9uZ2l0dWRlKSB0byBtYXRjaCB0aGVcbiAqIFtHZW9KU09OIHNwZWNpZmljYXRpb25dKGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM3OTQ2KS5cbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gbG5nIExvbmdpdHVkZSwgbWVhc3VyZWQgaW4gZGVncmVlcy5cbiAqIEBwYXJhbSB7bnVtYmVyfSBsYXQgTGF0aXR1ZGUsIG1lYXN1cmVkIGluIGRlZ3JlZXMuXG4gKiBAZXhhbXBsZVxuICogdmFyIGxsID0gbmV3IExuZ0xhdCgtMTIzLjk3NDksIDQwLjc3MzYpO1xuICogbGwubG5nOyAvLyA9IC0xMjMuOTc0OVxuICovXG4gY2xhc3MgTG5nTGF0IHtcbiAgICBsbmc6IG51bWJlcjtcbiAgICBsYXQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKGxuZzogbnVtYmVyLCBsYXQ6IG51bWJlcikge1xuICAgICAgICBpZiAoaXNOYU4obG5nKSB8fCBpc05hTihsYXQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgTG5nTGF0IG9iamVjdDogKCR7bG5nfSwgJHtsYXR9KWApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG5nID0gK2xuZztcbiAgICAgICAgdGhpcy5sYXQgPSArbGF0O1xuICAgICAgICBpZiAodGhpcy5sYXQgPiA5MCB8fCB0aGlzLmxhdCA8IC05MCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIExuZ0xhdCBsYXRpdHVkZSB2YWx1ZTogbXVzdCBiZSBiZXR3ZWVuIC05MCBhbmQgOTAnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRvTWVyY2F0b3JDb29yZCgpIHtcbiAgICAgICAgcmV0dXJuIHt4OiBtZXJjYXRvclhmcm9tTG5nKHRoaXMubG5nKSwgeTogbWVyY2F0b3JZZnJvbUxhdCh0aGlzLmxhdCl9O1xuICAgIH1cbn1cblxuZXhwb3J0IHtMbmdMYXR9O1xuZXhwb3J0IHR5cGUge01hcFR5cGV9OyIsIlxuaW1wb3J0IHsgZ2V0TWluWm9vbSB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyBCYXJiRGltU3BlYywgUG9seWxpbmVTcGVjLCBMaW5lU3BlYyB9IGZyb20gXCIuL0F1dHVtblR5cGVzXCI7XG5cbmltcG9ydCAqIGFzIENvbWxpbmsgZnJvbSAnY29tbGluayc7XG5pbXBvcnQgeyBCaWxsYm9hcmRTcGVjIH0gZnJvbSBcIi4vQmlsbGJvYXJkQ29sbGVjdGlvblwiO1xuaW1wb3J0IHsgTG5nTGF0IH0gZnJvbSBcIi4vTWFwXCI7XG5cbmZ1bmN0aW9uIG1ha2VCYXJiRWxlbWVudHMoZmllbGRfbGF0czogRmxvYXQzMkFycmF5LCBmaWVsZF9sb25zOiBGbG9hdDMyQXJyYXksIGZpZWxkX3U6IEZsb2F0MzJBcnJheSwgZmllbGRfdjogRmxvYXQzMkFycmF5LCB0aGluX2ZhY19iYXNlOiBudW1iZXIsIFxuICAgIEJBUkJfRElNUzogQmFyYkRpbVNwZWMpIDogQmlsbGJvYXJkU3BlYyB7XG4gICAgICAgIFxuICAgIGNvbnN0IEJBUkJfV0lEVEggPSBCQVJCX0RJTVNbJ0JBUkJfV0lEVEgnXTtcbiAgICBjb25zdCBCQVJCX1RFWF9XSURUSCA9IEJBUkJfRElNU1snQkFSQl9URVhfV0lEVEgnXTtcbiAgICBjb25zdCBCQVJCX0hFSUdIVCA9IEJBUkJfRElNU1snQkFSQl9IRUlHSFQnXTtcbiAgICBjb25zdCBCQVJCX1RFWF9IRUlHSFQgPSBCQVJCX0RJTVNbJ0JBUkJfVEVYX0hFSUdIVCddO1xuICAgIGNvbnN0IEJBUkJfVEVYX1dSQVAgPSBCQVJCX0RJTVNbJ0JBUkJfVEVYX1dSQVAnXTtcblxuICAgIGNvbnN0IG5fbGF0cyA9IGZpZWxkX2xhdHMubGVuZ3RoO1xuICAgIGNvbnN0IG5fbG9ucyA9IGZpZWxkX2xvbnMubGVuZ3RoO1xuICAgIGNvbnN0IG5fcHRzX3Blcl9wb2x5ID0gNjtcbiAgICBjb25zdCBuX2Nvb3Jkc19wZXJfcHRfcHRzID0gMztcbiAgICBjb25zdCBuX2Nvb3Jkc19wZXJfcHRfdGMgPSAyO1xuXG4gICAgY29uc3Qgbl9lbGVtc19wdHMgPSBuX2xhdHMgKiBuX2xvbnMgKiBuX3B0c19wZXJfcG9seSAqIG5fY29vcmRzX3Blcl9wdF9wdHM7XG4gICAgY29uc3Qgbl9lbGVtc190YyA9IG5fbGF0cyAqIG5fbG9ucyAqIG5fcHRzX3Blcl9wb2x5ICogbl9jb29yZHNfcGVyX3B0X3RjO1xuXG4gICAgbGV0IHB0cyA9IG5ldyBGbG9hdDMyQXJyYXkobl9lbGVtc19wdHMpO1xuICAgIGxldCBvZmZzZXQgPSBuZXcgRmxvYXQzMkFycmF5KG5fZWxlbXNfdGMpO1xuICAgIGxldCB0ZXhfY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheShuX2VsZW1zX3RjKTtcblxuICAgIGxldCBpc3RhcnRfcHRzID0gMDtcbiAgICBsZXQgaXN0YXJ0X3RjID0gMDtcblxuICAgIGNvbnN0IGJhcmJfd2lkdGhfZnJhYyA9IEJBUkJfV0lEVEggLyBCQVJCX1RFWF9XSURUSDtcbiAgICBjb25zdCBiYXJiX2hlaWdodF9mcmFjID0gQkFSQl9IRUlHSFQgLyBCQVJCX1RFWF9IRUlHSFQ7XG5cbiAgICBmaWVsZF9sYXRzLmZvckVhY2goKGxhdCwgaWxhdCkgPT4ge1xuICAgICAgICBmaWVsZF9sb25zLmZvckVhY2goKGxvbiwgaWxvbikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgem9vbSA9IGdldE1pblpvb20oaWxhdCwgaWxvbiwgdGhpbl9mYWNfYmFzZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHUgPSBmaWVsZF91W2lsYXQgKiBuX2xvbnMgKyBpbG9uXTtcbiAgICAgICAgICAgIGNvbnN0IHYgPSBmaWVsZF92W2lsYXQgKiBuX2xvbnMgKyBpbG9uXTtcbiAgICAgICAgICAgIGNvbnN0IGJhcmJfbWFnID0gTWF0aC5yb3VuZChNYXRoLmh5cG90KHUsIHYpIC8gNSkgKiA1O1xuICAgICAgICAgICAgY29uc3QgYmFyYl9hbmcgPSA5MCAtIE1hdGguYXRhbjIoLXYsIC11KSAqIDE4MCAvIE1hdGguUEk7XG5cbiAgICAgICAgICAgIGNvbnN0IHB0X2xsID0gbmV3IExuZ0xhdChsb24sIGxhdCkudG9NZXJjYXRvckNvb3JkKCk7XG5cbiAgICAgICAgICAgIC8vIFRoZXNlIGNvbnRhaW4gYSBkZWdlbmVyYXRlIHRyaWFuZ2xlIG9uIGVpdGhlciBlbmQgdG8gaW1pdGF0ZSBwcmltaXRpdmUgcmVzdGFydGluZ1xuICAgICAgICAgICAgLy8gIChzZWUgaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9nL3dlYmdsLWRldi1saXN0L2MvS0xmaXdqNGpheDAvbS9jS2llenJoUno4TUo/cGxpPTEpXG4gICAgICAgICAgICBmb3IgKGxldCBpY3JuciA9IDA7IGljcm5yIDwgbl9wdHNfcGVyX3BvbHk7IGljcm5yKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY3R1YWxfaWNybnIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpY3JuciAtIDEsIDMpKTtcblxuICAgICAgICAgICAgICAgIHB0c1tpc3RhcnRfcHRzICsgaWNybnIgKiBuX2Nvb3Jkc19wZXJfcHRfcHRzICsgMF0gPSBwdF9sbC54OyBcbiAgICAgICAgICAgICAgICBwdHNbaXN0YXJ0X3B0cyArIGljcm5yICogbl9jb29yZHNfcGVyX3B0X3B0cyArIDFdID0gcHRfbGwueTsgXG4gICAgICAgICAgICAgICAgcHRzW2lzdGFydF9wdHMgKyBpY3JuciAqIG5fY29vcmRzX3Blcl9wdF9wdHMgKyAyXSA9IHpvb207XG4gICAgICAgICAgICAgICAgb2Zmc2V0W2lzdGFydF90YyArIGljcm5yICogbl9jb29yZHNfcGVyX3B0X3RjICsgMF0gPSBhY3R1YWxfaWNybnI7IFxuICAgICAgICAgICAgICAgIG9mZnNldFtpc3RhcnRfdGMgKyBpY3JuciAqIG5fY29vcmRzX3Blcl9wdF90YyArIDFdID0gYmFyYl9hbmc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGlfYmFyYiA9IChiYXJiX21hZyAlIEJBUkJfVEVYX1dSQVApIC8gNTtcbiAgICAgICAgICAgIGNvbnN0IGpfYmFyYiA9IE1hdGguZmxvb3IoYmFyYl9tYWcgLyBCQVJCX1RFWF9XUkFQKTtcblxuICAgICAgICAgICAgdGV4X2Nvb3Jkc1tpc3RhcnRfdGMgKyAwIF0gPSAgaV9iYXJiICAgICAgKiBiYXJiX3dpZHRoX2ZyYWM7IHRleF9jb29yZHNbaXN0YXJ0X3RjICsgMSBdID0gIGpfYmFyYiAgICAgICogYmFyYl9oZWlnaHRfZnJhYztcbiAgICAgICAgICAgIHRleF9jb29yZHNbaXN0YXJ0X3RjICsgMiBdID0gIGlfYmFyYiAgICAgICogYmFyYl93aWR0aF9mcmFjOyB0ZXhfY29vcmRzW2lzdGFydF90YyArIDMgXSA9ICBqX2JhcmIgICAgICAqIGJhcmJfaGVpZ2h0X2ZyYWM7XG4gICAgICAgICAgICB0ZXhfY29vcmRzW2lzdGFydF90YyArIDQgXSA9IChpX2JhcmIgKyAxKSAqIGJhcmJfd2lkdGhfZnJhYzsgdGV4X2Nvb3Jkc1tpc3RhcnRfdGMgKyA1IF0gPSAgal9iYXJiICAgICAgKiBiYXJiX2hlaWdodF9mcmFjO1xuICAgICAgICAgICAgdGV4X2Nvb3Jkc1tpc3RhcnRfdGMgKyA2IF0gPSAgaV9iYXJiICAgICAgKiBiYXJiX3dpZHRoX2ZyYWM7IHRleF9jb29yZHNbaXN0YXJ0X3RjICsgNyBdID0gKGpfYmFyYiArIDEpICogYmFyYl9oZWlnaHRfZnJhYztcbiAgICAgICAgICAgIHRleF9jb29yZHNbaXN0YXJ0X3RjICsgOCBdID0gKGlfYmFyYiArIDEpICogYmFyYl93aWR0aF9mcmFjOyB0ZXhfY29vcmRzW2lzdGFydF90YyArIDkgXSA9IChqX2JhcmIgKyAxKSAqIGJhcmJfaGVpZ2h0X2ZyYWM7XG4gICAgICAgICAgICB0ZXhfY29vcmRzW2lzdGFydF90YyArIDEwXSA9IChpX2JhcmIgKyAxKSAqIGJhcmJfd2lkdGhfZnJhYzsgdGV4X2Nvb3Jkc1tpc3RhcnRfdGMgKyAxMV0gPSAoal9iYXJiICsgMSkgKiBiYXJiX2hlaWdodF9mcmFjO1xuXG4gICAgICAgICAgICBpc3RhcnRfcHRzICs9IChuX3B0c19wZXJfcG9seSAqIG5fY29vcmRzX3Blcl9wdF9wdHMpO1xuICAgICAgICAgICAgaXN0YXJ0X3RjICs9IChuX3B0c19wZXJfcG9seSAqIG5fY29vcmRzX3Blcl9wdF90Yyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsncHRzJzogcHRzLCAnb2Zmc2V0Jzogb2Zmc2V0LCAndGV4X2Nvb3Jkcyc6IHRleF9jb29yZHN9O1xufVxuXG5mdW5jdGlvbiBtYWtlRG9tYWluVmVydGljZXNBbmRUZXhDb29yZHMoZmllbGRfbGF0czogRmxvYXQzMkFycmF5LCBmaWVsZF9sb25zOiBGbG9hdDMyQXJyYXksIHRleF93aWR0aDogbnVtYmVyLCB0ZXhfaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBjb25zdCBuaSA9IGZpZWxkX2xvbnMubGVuZ3RoO1xuICAgIGNvbnN0IGxiaSA9IDAsIHViaSA9IG5pIC0gMTtcblxuICAgIGNvbnN0IGNvcm5lcnMgPSBbLi4uZmllbGRfbGF0c10ubWFwKGxhdCA9PiB7XG4gICAgICAgIHJldHVybiBbeydsbmcnOiBmaWVsZF9sb25zW2xiaV0sICdsYXQnOiBsYXR9LFxuICAgICAgICAgICAgICAgIHsnbG5nJzogZmllbGRfbG9uc1t1YmldLCAnbGF0JzogbGF0fV1cbiAgICB9KS5mbGF0KCkubWFwKHB0ID0+IG5ldyBMbmdMYXQocHQubG5nLCBwdC5sYXQpLnRvTWVyY2F0b3JDb29yZCgpKTtcbiAgICBjb25zdCB2ZXJ0cyA9IGNvcm5lcnMubWFwKGNkID0+IFtjZC54LCBjZC55XSkuZmxhdCgpO1xuXG4gICAgY29uc3QgdGV4X2Nvb3JkcyA9IFsuLi5maWVsZF9sYXRzXS5tYXAoKGxhdCwgaWxhdCkgPT4ge1xuICAgICAgICByZXR1cm4gW3sncyc6IChpbGF0ICsgMC41KSAvIHRleF9oZWlnaHQsICdyJzogMC41MDUgLyAodGV4X3dpZHRoICsgMS4wNyl9LCBcbiAgICAgICAgICAgICAgICB7J3MnOiAoaWxhdCArIDAuNSkgLyB0ZXhfaGVpZ2h0LCAncic6IChuaSArIDAuNTA1KSAvICh0ZXhfd2lkdGggKyAxLjA3KX1dO1xuICAgIH0pLmZsYXQoKS5tYXAodGMgPT4gW3RjWydyJ10sIHRjWydzJ11dKS5mbGF0KCk7XG5cbiAgICByZXR1cm4geyd2ZXJ0aWNlcyc6IG5ldyBGbG9hdDMyQXJyYXkodmVydHMpLCAndGV4X2Nvb3Jkcyc6IG5ldyBGbG9hdDMyQXJyYXkodGV4X2Nvb3Jkcyl9XG59XG5cbi8qXG5mdW5jdGlvbiBtYWtlUG9seWxpbmVzTWl0ZXIobGluZXMpIHtcbiAgICBjb25zdCBuX3BvaW50c19wZXJfdmVydCA9IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhsaW5lc1swXSkubWFwKChbaywgdl0pID0+IHtcbiAgICAgICAgbGV0IG5fdmVydHM7XG4gICAgICAgIGlmICh2Lmxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBuX3ZlcnRzID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5fdmVydHMgPSBrID09ICd2ZXJ0cycgPyB2WzBdLmxlbmd0aCA6IHYubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbaywgbl92ZXJ0c107XG4gICAgfSkpO1xuICAgIG5fcG9pbnRzX3Blcl92ZXJ0WydleHRydXNpb24nXSA9IDI7XG5cbiAgICBjb25zdCBuX3ZlcnRzID0gbGluZXMubWFwKGwgPT4gbFsndmVydHMnXS5sZW5ndGgpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpO1xuICAgIGNvbnN0IGFyeV9sZW5zID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKG5fcG9pbnRzX3Blcl92ZXJ0KS5tYXAoKFtrLCBucHB2XSkgPT4gW2ssIChuX3ZlcnRzICogMiArIGxpbmVzLmxlbmd0aCAqIDIpICogbnBwdl0pKTtcblxuICAgIGxldCByZXQgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoYXJ5X2xlbnMpLm1hcCgoW2ssIHZdKSA9PiBbaywgbmV3IEZsb2F0MzJBcnJheSh2KV0pKTtcblxuICAgIGxldCBpbG5zID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKGFyeV9sZW5zKS5tYXAoayA9PiBbaywgMF0pKTtcblxuICAgIGNvbnN0IGlzX2N3X3dpbmRpbmcgPSAocHRfcHJldiwgcHRfdGhpcywgcHRfbmV4dCkgPT4ge1xuICAgICAgICBjb25zdCB3aW5kaW5nID0gKHB0X3RoaXNbMF0gLSBwdF9wcmV2WzBdKSAqIChwdF90aGlzWzFdICsgcHRfcHJldlsxXSkgXG4gICAgICAgICAgICAgICAgICAgICAgKyAocHRfbmV4dFswXSAtIHB0X3RoaXNbMF0pICogKHB0X25leHRbMV0gKyBwdF90aGlzWzFdKSBcbiAgICAgICAgICAgICAgICAgICAgICArIChwdF9wcmV2WzBdIC0gcHRfbmV4dFswXSkgKiAocHRfcHJldlsxXSArIHB0X25leHRbMV0pO1xuXG4gICAgICAgIHJldHVybiB3aW5kaW5nID4gMDtcbiAgICB9XG5cbiAgICBjb25zdCBjYWxjdWxhdGVfZXh0cnVzaW9uID0gKHB0X3ByZXYsIHB0X3RoaXMsIHB0X25leHQpID0+IHtcbiAgICAgICAgbGV0IGxpbmVfdmVjX3hfcHJldiwgbGluZV92ZWNfeV9wcmV2LCBsaW5lX3ZlY19tYWdfcHJldiwgXG4gICAgICAgICAgICBsaW5lX3ZlY194X25leHQsIGxpbmVfdmVjX3lfbmV4dCwgbGluZV92ZWNfbWFnX25leHQ7XG4gICAgICAgIGxldCBleHRfeCwgZXh0X3k7XG5cbiAgICAgICAgaWYgKHB0X3ByZXYgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGxpbmVfdmVjX3hfcHJldiA9IHB0X3RoaXNbMF0gLSBwdF9wcmV2WzBdO1xuICAgICAgICAgICAgbGluZV92ZWNfeV9wcmV2ID0gcHRfdGhpc1sxXSAtIHB0X3ByZXZbMV07XG4gICAgICAgICAgICBsaW5lX3ZlY19tYWdfcHJldiA9IE1hdGguaHlwb3QobGluZV92ZWNfeF9wcmV2LCBsaW5lX3ZlY195X3ByZXYpO1xuICAgICAgICAgICAgbGluZV92ZWNfeF9wcmV2IC89IGxpbmVfdmVjX21hZ19wcmV2O1xuICAgICAgICAgICAgbGluZV92ZWNfeV9wcmV2IC89IGxpbmVfdmVjX21hZ19wcmV2O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHB0X25leHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGxpbmVfdmVjX3hfbmV4dCA9IHB0X25leHRbMF0gLSBwdF90aGlzWzBdO1xuICAgICAgICAgICAgbGluZV92ZWNfeV9uZXh0ID0gcHRfbmV4dFsxXSAtIHB0X3RoaXNbMV07XG4gICAgICAgICAgICBsaW5lX3ZlY19tYWdfbmV4dCA9IE1hdGguaHlwb3QobGluZV92ZWNfeF9uZXh0LCBsaW5lX3ZlY195X25leHQpO1xuICAgICAgICAgICAgbGluZV92ZWNfeF9uZXh0IC89IGxpbmVfdmVjX21hZ19uZXh0O1xuICAgICAgICAgICAgbGluZV92ZWNfeV9uZXh0IC89IGxpbmVfdmVjX21hZ19uZXh0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHB0X3ByZXYgPT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIEZpcnN0IHBvaW50IGluIHRoZSBsaW5lIGdldHMganVzdCB0aGUgbm9ybWFsIGZvciB0aGUgZmlyc3Qgc2VnbWVudFxuICAgICAgICAgICAgZXh0X3ggPSBsaW5lX3ZlY195X25leHQ7IGV4dF95ID0gLWxpbmVfdmVjX3hfbmV4dDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwdF90aGlzID09PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBMYXN0IHBvaW50IGluIHRoZSBsaW5lIGdldHMganVzdCB0aGUgbm9ybWFsIGZvciB0aGUgbGFzdCBzZWdtZW50XG4gICAgICAgICAgICBleHRfeCA9IGxpbmVfdmVjX3lfcHJldjsgZXh0X3kgPSAtbGluZV92ZWNfeF9wcmV2O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gTWl0ZXIgam9pbjogY29tcHV0ZSB0aGUgZXh0cnVzaW9uIHZlY3RvciBoYWxmd2F5IGJldHdlZW4gdGhlIG5leHQgYW5kIHByZXZpb3VzIG5vcm1hbFxuICAgICAgICAgICAgY29uc3QgZG90ID0gbGluZV92ZWNfeF9wcmV2ICogbGluZV92ZWNfeF9uZXh0ICsgbGluZV92ZWNfeV9wcmV2ICogbGluZV92ZWNfeV9uZXh0O1xuICAgICAgICAgICAgY29uc3QgZXh0X2ZhYyA9IE1hdGguc3FydCgoMSAtIGRvdCkgLyAoMSArIGRvdCkpO1xuICAgICAgICAgICAgY29uc3Qgc2lnbiA9IGlzX2N3X3dpbmRpbmcocHRfcHJldiwgcHRfdGhpcywgcHRfdGhpcykgPyAtMSA6IDE7XG4gICAgICAgICAgICBleHRfeCA9IGxpbmVfdmVjX3lfcHJldiAgICAgICAgICAgICAgICAgICsgc2lnbiAqIGxpbmVfdmVjX3hfcHJldiAqIGV4dF9mYWM7XG4gICAgICAgICAgICBleHRfeSA9IHNpZ24gKiBsaW5lX3ZlY195X3ByZXYgKiBleHRfZmFjIC0gbGluZV92ZWNfeF9wcmV2O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFtleHRfeCwgZXh0X3ldO1xuICAgIH1cblxuICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgIGNvbnN0IHZlcnRzID0gbGluZVsndmVydHMnXTtcbiAgICAgICAgbGV0IGV4dF94LCBleHRfeTtcblxuICAgICAgICBsZXQgaXZ0ID0gMDtcbiAgICAgICAgcmV0Wyd2ZXJ0cyddW2lsbnNbJ3ZlcnRzJ11dID0gdmVydHNbaXZ0XVswXTsgcmV0Wyd2ZXJ0cyddW2lsbnNbJ3ZlcnRzJ10gKyAxXSA9IHZlcnRzW2l2dF1bMV07XG5cbiAgICAgICAgW2V4dF94LCBleHRfeV0gPSBjYWxjdWxhdGVfZXh0cnVzaW9uKG51bGwsIHZlcnRzW2l2dF0sIHZlcnRzW2l2dCArIDFdKTtcbiAgICAgICAgcmV0WydleHRydXNpb24nXVtpbG5zWydleHRydXNpb24nXV0gPSBleHRfeDsgcmV0WydleHRydXNpb24nXVtpbG5zWydleHRydXNpb24nXSArIDFdID0gZXh0X3k7XG5cbiAgICAgICAgZm9yIChpdnQgPSAwOyBpdnQgPCB2ZXJ0cy5sZW5ndGg7IGl2dCsrKSB7XG4gICAgICAgICAgICBjb25zdCBhcnlfaXZ0ID0gaWxuc1sndmVydHMnXSArIDIgKiAoMiAqIGl2dCArIDEpO1xuICAgICAgICAgICAgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyAwXSA9IHZlcnRzW2l2dF1bMF07IHJldFsndmVydHMnXVthcnlfaXZ0ICsgMV0gPSB2ZXJ0c1tpdnRdWzFdO1xuICAgICAgICAgICAgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyAyXSA9IHZlcnRzW2l2dF1bMF07IHJldFsndmVydHMnXVthcnlfaXZ0ICsgM10gPSB2ZXJ0c1tpdnRdWzFdO1xuXG4gICAgICAgICAgICBpZiAoaXZ0ID09IDApIHtcbiAgICAgICAgICAgICAgICBbZXh0X3gsIGV4dF95XSA9IGNhbGN1bGF0ZV9leHRydXNpb24obnVsbCwgdmVydHNbaXZ0XSwgdmVydHNbaXZ0ICsgMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXZ0ID09IHZlcnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBbZXh0X3gsIGV4dF95XSA9IGNhbGN1bGF0ZV9leHRydXNpb24odmVydHNbaXZ0IC0gMV0sIHZlcnRzW2l2dF0sIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgW2V4dF94LCBleHRfeV0gPSBjYWxjdWxhdGVfZXh0cnVzaW9uKHZlcnRzW2l2dCAtIDFdLCB2ZXJ0c1tpdnRdLCB2ZXJ0c1tpdnQgKyAxXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDBdID0gIGV4dF94OyByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyAxXSA9ICBleHRfeTtcbiAgICAgICAgICAgIHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDJdID0gLWV4dF94OyByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyAzXSA9IC1leHRfeTtcbiAgICAgICAgfVxuXG4gICAgICAgIGl2dCA9IHZlcnRzLmxlbmd0aCAtIDE7XG4gICAgICAgIHJldFsndmVydHMnXVtpbG5zWyd2ZXJ0cyddICsgMiAqICgyICogaXZ0ICsgMSkgKyA0XSA9IHZlcnRzW2l2dF1bMF07IFxuICAgICAgICByZXRbJ3ZlcnRzJ11baWxuc1sndmVydHMnXSArIDIgKiAoMiAqIGl2dCArIDEpICsgNV0gPSB2ZXJ0c1tpdnRdWzFdO1xuICAgICAgICBcbiAgICAgICAgW2V4dF94LCBleHRfeV0gPSBjYWxjdWxhdGVfZXh0cnVzaW9uKHZlcnRzW2l2dCAtIDFdLCB2ZXJ0c1tpdnRdLCBudWxsKTtcblxuICAgICAgICByZXRbJ2V4dHJ1c2lvbiddW2lsbnNbJ2V4dHJ1c2lvbiddICsgMiAqICgyICogaXZ0ICsgMSkgKyA0XSA9IC1leHRfeDsgXG4gICAgICAgIHJldFsnZXh0cnVzaW9uJ11baWxuc1snZXh0cnVzaW9uJ10gKyAyICogKDIgKiBpdnQgKyAxKSArIDVdID0gLWV4dF95O1xuXG4gICAgICAgIGZvciAobGV0IGtleSBpbiByZXQpIHtcbiAgICAgICAgICAgIGlmIChrZXkgPT0gJ3ZlcnRzJyB8fCBrZXkgPT0gJ2V4dHJ1c2lvbicpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBmb3IgKGl2dCA9IDA7IGl2dCA8ICh2ZXJ0cy5sZW5ndGggKiAyICsgMikgKiBuX3BvaW50c19wZXJfdmVydFtrZXldOyBpdnQgKz0gbl9wb2ludHNfcGVyX3ZlcnRba2V5XSkge1xuICAgICAgICAgICAgICAgIGlmIChsaW5lW2tleV0ubGVuZ3RoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZVtrZXldLmZvckVhY2goKGNkLCBpY2QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFtrZXldW2lsbnNba2V5XSArIGl2dCArIGljZF0gPSBjZDtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldFtrZXldW2lsbnNba2V5XSArIGl2dF0gPSBsaW5lW2tleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgT2JqZWN0LmtleXMoaWxucykuZm9yRWFjaChrID0+IHtcbiAgICAgICAgICAgIGlsbnNba10gKz0gKHZlcnRzLmxlbmd0aCAqIDIgKyAyKSAqIG5fcG9pbnRzX3Blcl92ZXJ0W2tdO1xuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICByZXR1cm4gcmV0O1xufVxuKi9cblxuZnVuY3Rpb24gbWFrZVBvbHlsaW5lcyhsaW5lczogTGluZVNwZWNbXSkgOiBQb2x5bGluZVNwZWMge1xuICAgIGNvbnN0IG5fcG9pbnRzX3Blcl92ZXJ0ID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKGxpbmVzWzBdKS5tYXAoKFtrLCB2XSkgPT4ge1xuICAgICAgICBsZXQgbl92ZXJ0czogbnVtYmVyO1xuICAgICAgICBpZiAodi5sZW5ndGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbl92ZXJ0cyA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodlswXS5sZW5ndGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbl92ZXJ0cyA9IHYubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbl92ZXJ0cyA9IHZbMF0ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbaywgbl92ZXJ0c107XG4gICAgfSkpO1xuICAgIG5fcG9pbnRzX3Blcl92ZXJ0WydleHRydXNpb24nXSA9IDI7XG5cbiAgICBjb25zdCBuX3ZlcnRzID0gbGluZXMubWFwKGwgPT4gbFsndmVydHMnXS5sZW5ndGgpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpO1xuICAgIGNvbnN0IG5fb3V0X3ZlcnRzID0gKG5fdmVydHMgLSBsaW5lcy5sZW5ndGgpICogNjtcbiAgICBjb25zdCBhcnlfbGVucyA9IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhuX3BvaW50c19wZXJfdmVydCkubWFwKChbaywgbnBwdl0pID0+IFtrLCBuX291dF92ZXJ0cyAqIG5wcHZdKSk7XG5cbiAgICBsZXQgcmV0OiBQb2x5bGluZVNwZWMgPSB7XG4gICAgICAgICd2ZXJ0cyc6IG5ldyBGbG9hdDMyQXJyYXkoYXJ5X2xlbnNbJ3ZlcnRzJ10pLFxuICAgICAgICAnb3JpZ2luJzogbmV3IEZsb2F0MzJBcnJheShhcnlfbGVuc1snb3JpZ2luJ10pLFxuICAgICAgICAnZXh0cnVzaW9uJzogbmV3IEZsb2F0MzJBcnJheShhcnlfbGVuc1snZXh0cnVzaW9uJ10pLFxuICAgICAgICAnem9vbSc6IG5ldyBGbG9hdDMyQXJyYXkoYXJ5X2xlbnNbJ3pvb20nXSksXG4gICAgICAgICd0ZXhjb29yZHMnOiBuZXcgRmxvYXQzMkFycmF5KGFyeV9sZW5zWyd0ZXhjb29yZHMnXSksXG4gICAgfVxuXG4gICAgbGV0IGlsbnMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXMoYXJ5X2xlbnMpLm1hcChrID0+IFtrLCAwXSkpO1xuXG4gICAgY29uc3QgY29tcHV0ZV9ub3JtYWxfdmVjID0gKHB0MTogW251bWJlciwgbnVtYmVyXSwgcHQyOiBbbnVtYmVyLCBudW1iZXJdKSA9PiB7XG4gICAgICAgIGNvbnN0IGxpbmVfdmVjX3ggPSBwdDJbMF0gLSBwdDFbMF07XG4gICAgICAgIGNvbnN0IGxpbmVfdmVjX3kgPSBwdDJbMV0gLSBwdDFbMV07XG4gICAgICAgIGNvbnN0IGxpbmVfdmVjX21hZyA9IE1hdGguaHlwb3QobGluZV92ZWNfeCwgbGluZV92ZWNfeSk7XG5cbiAgICAgICAgcmV0dXJuIFtsaW5lX3ZlY195IC8gbGluZV92ZWNfbWFnLCAtbGluZV92ZWNfeCAvIGxpbmVfdmVjX21hZ107XG4gICAgfVxuXG4gICAgbGluZXMuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgY29uc3QgdmVydHMgPSBsaW5lWyd2ZXJ0cyddO1xuICAgICAgICBjb25zdCB0ZXhjb29yZHMgPSBsaW5lWyd0ZXhjb29yZHMnXTtcblxuICAgICAgICBsZXQgYXJ5X2l2dCA9IGlsbnNbJ3ZlcnRzJ107XG4gICAgICAgIGxldCBwdF9wcmV2OiBbbnVtYmVyLCBudW1iZXJdLCBwdF90aGlzID0gdmVydHNbMF0sIHB0X25leHQgPSB2ZXJ0c1sxXTtcbiAgICAgICAgbGV0IHRjX3ByZXY6IFtudW1iZXIsIG51bWJlcl0sIHRjX3RoaXMgPSB0ZXhjb29yZHNbMF0sIHRjX25leHQgPSB0ZXhjb29yZHNbMV07XG4gICAgICAgIGxldCBbZXh0X3gsIGV4dF95XSA9IGNvbXB1dGVfbm9ybWFsX3ZlYyhwdF90aGlzLCBwdF9uZXh0KTtcblxuICAgICAgICByZXRbJ3ZlcnRzJ11bYXJ5X2l2dCArIDBdID0gcHRfdGhpc1swXTsgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyAxXSA9IHB0X3RoaXNbMV07XG4gICAgICAgIHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDBdID0gdGNfdGhpc1swXTsgcmV0Wyd0ZXhjb29yZHMnXVthcnlfaXZ0ICsgMV0gPSB0Y190aGlzWzFdO1xuICAgICAgICByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyAwXSA9IGV4dF94OyByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyAxXSA9IGV4dF95O1xuXG4gICAgICAgIGZvciAobGV0IGl2dCA9IDE7IGl2dCA8IHZlcnRzLmxlbmd0aDsgaXZ0KyspIHtcbiAgICAgICAgICAgIHB0X3RoaXMgPSB2ZXJ0c1tpdnRdOyBwdF9wcmV2ID0gdmVydHNbaXZ0IC0gMV07XG4gICAgICAgICAgICB0Y190aGlzID0gdGV4Y29vcmRzW2l2dF07IHRjX3ByZXYgPSB0ZXhjb29yZHNbaXZ0IC0gMV07XG4gICAgICAgICAgICBbZXh0X3gsIGV4dF95XSA9IGNvbXB1dGVfbm9ybWFsX3ZlYyhwdF9wcmV2LCBwdF90aGlzKTtcblxuICAgICAgICAgICAgYXJ5X2l2dCA9IGlsbnNbJ3ZlcnRzJ10gKyAoMSArIChpdnQgLSAxKSAqIDQpICogbl9wb2ludHNfcGVyX3ZlcnRbJ3ZlcnRzJ107XG5cbiAgICAgICAgICAgIHJldFsndmVydHMnXVthcnlfaXZ0ICsgMF0gPSBwdF9wcmV2WzBdOyByZXRbJ3ZlcnRzJ11bYXJ5X2l2dCArIDFdID0gcHRfcHJldlsxXTtcbiAgICAgICAgICAgIHJldFsndmVydHMnXVthcnlfaXZ0ICsgMl0gPSBwdF9wcmV2WzBdOyByZXRbJ3ZlcnRzJ11bYXJ5X2l2dCArIDNdID0gcHRfcHJldlsxXTtcblxuICAgICAgICAgICAgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyA0XSA9IHB0X3RoaXNbMF07IHJldFsndmVydHMnXVthcnlfaXZ0ICsgNV0gPSBwdF90aGlzWzFdO1xuICAgICAgICAgICAgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyA2XSA9IHB0X3RoaXNbMF07IHJldFsndmVydHMnXVthcnlfaXZ0ICsgN10gPSBwdF90aGlzWzFdO1xuXG4gICAgICAgICAgICByZXRbJ3RleGNvb3JkcyddW2FyeV9pdnQgKyAwXSA9IHRjX3ByZXZbMF07IHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDFdID0gdGNfcHJldlsxXTtcbiAgICAgICAgICAgIHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDJdID0gdGNfcHJldlswXTsgcmV0Wyd0ZXhjb29yZHMnXVthcnlfaXZ0ICsgM10gPSB0Y19wcmV2WzFdO1xuXG4gICAgICAgICAgICByZXRbJ3RleGNvb3JkcyddW2FyeV9pdnQgKyA0XSA9IHRjX3RoaXNbMF07IHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDVdID0gdGNfdGhpc1sxXTtcbiAgICAgICAgICAgIHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDZdID0gdGNfdGhpc1swXTsgcmV0Wyd0ZXhjb29yZHMnXVthcnlfaXZ0ICsgN10gPSB0Y190aGlzWzFdO1xuXG4gICAgICAgICAgICByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyAwIF0gPSAgZXh0X3g7IHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDEgXSA9ICBleHRfeTtcbiAgICAgICAgICAgIHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDIgXSA9IC1leHRfeDsgcmV0WydleHRydXNpb24nXVthcnlfaXZ0ICsgMyBdID0gLWV4dF95O1xuXG4gICAgICAgICAgICByZXRbJ2V4dHJ1c2lvbiddW2FyeV9pdnQgKyA0IF0gPSAgZXh0X3g7IHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDUgXSA9ICBleHRfeTtcbiAgICAgICAgICAgIHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDYgXSA9IC1leHRfeDsgcmV0WydleHRydXNpb24nXVthcnlfaXZ0ICsgNyBdID0gLWV4dF95O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0Wyd2ZXJ0cyddW2FyeV9pdnQgKyA4XSA9IHB0X3RoaXNbMF07IHJldFsndmVydHMnXVthcnlfaXZ0ICsgOV0gPSBwdF90aGlzWzFdO1xuICAgICAgICByZXRbJ3RleGNvb3JkcyddW2FyeV9pdnQgKyA4XSA9IHRjX3RoaXNbMF07IHJldFsndGV4Y29vcmRzJ11bYXJ5X2l2dCArIDldID0gdGNfdGhpc1sxXTtcbiAgICAgICAgcmV0WydleHRydXNpb24nXVthcnlfaXZ0ICsgOF0gPSAtZXh0X3g7IHJldFsnZXh0cnVzaW9uJ11bYXJ5X2l2dCArIDldID0gLWV4dF95O1xuXG4gICAgICAgIGZvciAobGV0IGl2dCA9IDA7IGl2dCA8ICh2ZXJ0cy5sZW5ndGggLSAxKSAqIDYgKiBuX3BvaW50c19wZXJfdmVydFsnb3JpZ2luJ107IGl2dCArPSBuX3BvaW50c19wZXJfdmVydFsnb3JpZ2luJ10pIHtcbiAgICAgICAgICAgIGxpbmVbJ29yaWdpbiddLmZvckVhY2goKGNkLCBpY2QpID0+IHtcbiAgICAgICAgICAgICAgICByZXRbJ29yaWdpbiddW2lsbnNbJ29yaWdpbiddICsgaXZ0ICsgaWNkXSA9IGNkO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yIChsZXQgaXZ0ID0gMDsgaXZ0IDwgKHZlcnRzLmxlbmd0aCAtIDEpICogNiAqIG5fcG9pbnRzX3Blcl92ZXJ0Wyd6b29tJ107IGl2dCArPSBuX3BvaW50c19wZXJfdmVydFsnem9vbSddKSB7XG4gICAgICAgICAgICByZXRbJ3pvb20nXVtpbG5zWyd6b29tJ10gKyBpdnRdID0gbGluZVsnem9vbSddO1xuICAgICAgICB9XG5cbiAgICAgICAgT2JqZWN0LmtleXMoaWxucykuZm9yRWFjaChrID0+IHtcbiAgICAgICAgICAgIGlsbnNba10gKz0gKHZlcnRzLmxlbmd0aCAtIDEpICogNiAqIG5fcG9pbnRzX3Blcl92ZXJ0W2tdO1xuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICByZXR1cm4gcmV0O1xufVxuXG5jb25zdCBlcF9pbnRlcmZhY2UgPSB7XG4gICAgJ21ha2VCYXJiRWxlbWVudHMnOiBtYWtlQmFyYkVsZW1lbnRzLCBcbiAgICAnbWFrZURvbWFpblZlcnRpY2VzQW5kVGV4Q29vcmRzJzogbWFrZURvbWFpblZlcnRpY2VzQW5kVGV4Q29vcmRzLFxuICAgICdtYWtlUG9seUxpbmVzJzogbWFrZVBvbHlsaW5lc1xufVxuXG50eXBlIFBsb3RMYXllcldvcmtlciA9IHR5cGVvZiBlcF9pbnRlcmZhY2U7XG5cbkNvbWxpbmsuZXhwb3NlKGVwX2ludGVyZmFjZSk7XG5cbmV4cG9ydCB0eXBlIHtQbG90TGF5ZXJXb3JrZXJ9IiwiXG5jb25zdCBoZXgycmdiYSA9IChoZXhzdHI6IHN0cmluZywgb3V0X3R5cGU/OiBzdHJpbmcpIDogW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPT4ge1xuICAgIG91dF90eXBlID0gb3V0X3R5cGUgPT09IHVuZGVmaW5lZCA/ICdmbG9hdCcgOiBvdXRfdHlwZTtcblxuICAgIGNvbnN0IG1hdGNoID0gaGV4c3RyLm1hdGNoKC8jKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KT8vaSk7XG4gICAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IGBHb3QgJyR7aGV4c3RyfScgaW4gaGV4MnJnYmEsIHdoaWNoIGRvZXMgbm90IGxvb2sgbGlrZSBhIGhleCBjb2xvcmA7XG4gICAgfVxuXG4gICAgbGV0IHJnYmEgPSBtYXRjaC5zbGljZSgxKS5maWx0ZXIoYyA9PiBjICE9PSB1bmRlZmluZWQpLm1hcChjID0+IHBhcnNlSW50KGMsIDE2KSk7XG5cbiAgICBpZiAob3V0X3R5cGUgPT0gJ2Zsb2F0Jykge1xuICAgICAgICByZ2JhID0gcmdiYS5tYXAoYyA9PiBjIC8gMjU1KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmdiYVszXSA9PT0gdW5kZWZpbmVkID8gW3JnYmFbMF0sIHJnYmFbMV0sIHJnYmFbMl0sIDFdIDogW3JnYmFbMF0sIHJnYmFbMV0sIHJnYmFbMl0sIHJnYmFbM11dO1xufVxuXG5jb25zdCByZ2JhMmhleCA9IChyZ2JhOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXSwgaW5fdHlwZT86IHN0cmluZykgOiBzdHJpbmcgPT4ge1xuICAgIGluX3R5cGUgPSBpbl90eXBlID09PSB1bmRlZmluZWQgPyAnZmxvYXQnIDogaW5fdHlwZTtcblxuICAgIGxldCByZ2JhXyA9IHJnYmEgYXMgbnVtYmVyW107XG4gICAgaWYgKGluX3R5cGUgPT0gJ2Zsb2F0Jykge1xuICAgICAgICByZ2JhXyA9IHJnYmFfLm1hcChjID0+IE1hdGgucm91bmQoYyAqIDI1NSkpO1xuICAgIH1cblxuICAgIHJldHVybiAnIycgKyByZ2JhXy5tYXAoYyA9PiBjLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpLnRvVXBwZXJDYXNlKCkpLmpvaW4oJycpO1xufVxuXG5jb25zdCBoZXgycmdiID0gKGhleHN0cjogc3RyaW5nLCBvdXRfdHlwZT86IHN0cmluZykgOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPT4ge1xuICAgIGNvbnN0W3IsIGcsIGIsIGFdID0gaGV4MnJnYmEoaGV4c3RyLCBvdXRfdHlwZSk7XG4gICAgcmV0dXJuIFtyLCBnLCBiXTtcbn1cblxuY29uc3QgcmdiMmhleCA9IChyZ2I6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSwgaW5fdHlwZT86IHN0cmluZykgOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IFtyLCBnLCBiXSA9IHJnYjtcbiAgICByZXR1cm4gcmdiYTJoZXgoW3IsIGcsIGIsIDBdLCBpbl90eXBlKS5zbGljZSgwLCAtMik7XG59XG5cbmNvbnN0IHJnYjJoc3YgPSAocmdiOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0pIDogW251bWJlciwgbnVtYmVyLCBudW1iZXJdID0+IHtcbiAgICBjb25zdCBbciwgZywgYl0gPSByZ2I7XG5cbiAgICBjb25zdCBDbWF4ID0gTWF0aC5tYXgociwgZywgYik7XG4gICAgY29uc3QgQ21pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIGNvbnN0IERlbHRhID0gQ21heCAtIENtaW47XG4gICAgXG4gICAgbGV0IEg6IG51bWJlcjtcbiAgICBpZiAoRGVsdGEgPT0gMCkge1xuICAgICAgICBIID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoQ21heCA9PSByKSB7XG4gICAgICAgIEggPSA2MCAqICgoZyAtIGIpIC8gRGVsdGEpICUgNjtcbiAgICB9XG4gICAgZWxzZSBpZiAoQ21heCA9PSBnKSB7XG4gICAgICAgIEggPSA2MCAqICgoYiAtIHIpIC8gRGVsdGEgKyAyKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoQ21heCA9PSBiKSB7XG4gICAgICAgIEggPSA2MCAqICgociAtIGcpIC8gRGVsdGEgKyA0KTtcbiAgICB9XG5cbiAgICBsZXQgUyA9IENtYXggPT0gMCA/IDAgOiBEZWx0YSAvIENtYXg7XG4gICAgbGV0IFYgPSBDbWF4O1xuXG4gICAgcmV0dXJuIFtILCBTLCBWXTtcbn1cblxuY29uc3QgaHN2MnJnYiA9IChoc3Y6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSkgOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPT4ge1xuICAgIGNvbnN0IFtILCBTLCBWXSA9IGhzdjtcblxuICAgIGNvbnN0IEMgPSBWICogUztcbiAgICBjb25zdCBYID0gQyAqICgxIC0gTWF0aC5hYnMoSCAvIDYwICUgMiAtIDEpKTtcbiAgICBjb25zdCBtID0gViAtIEM7XG5cbiAgICBsZXQgcl9wcmltZSwgZ19wcmltZSwgYl9wcmltZTtcbiAgICBpZiAoMCA8PSBIICYmIEggPCA2MCkge1xuICAgICAgICByX3ByaW1lID0gQzsgZ19wcmltZSA9IFgsIGJfcHJpbWUgPSAwO1xuICAgIH1cbiAgICBlbHNlIGlmICg2MCA8PSBIICYmIEggPCAxMjApIHtcbiAgICAgICAgcl9wcmltZSA9IFg7IGdfcHJpbWUgPSBDLCBiX3ByaW1lID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoMTIwIDw9IEggJiYgSCA8IDE4MCkge1xuICAgICAgICByX3ByaW1lID0gMDsgZ19wcmltZSA9IEMsIGJfcHJpbWUgPSBYO1xuICAgIH1cbiAgICBlbHNlIGlmICgxODAgPD0gSCAmJiBIIDwgMjQwKSB7XG4gICAgICAgIHJfcHJpbWUgPSAwOyBnX3ByaW1lID0gWCwgYl9wcmltZSA9IEM7XG4gICAgfVxuICAgIGVsc2UgaWYgKDI0MCA8PSBIICYmIEggPCAzMDApIHtcbiAgICAgICAgcl9wcmltZSA9IFg7IGdfcHJpbWUgPSAwLCBiX3ByaW1lID0gQztcbiAgICB9XG4gICAgZWxzZSBpZiAoMzAwIDw9IEggJiYgSCA8IDM2MCkge1xuICAgICAgICByX3ByaW1lID0gQzsgZ19wcmltZSA9IDAsIGJfcHJpbWUgPSBYO1xuICAgIH1cblxuICAgIHJldHVybiBbcl9wcmltZSArIG0sIGdfcHJpbWUgKyBtLCBiX3ByaW1lICsgbV07XG59XG5cbmZ1bmN0aW9uIGdldE1pblpvb20oamxhdDogbnVtYmVyLCBpbG9uOiBudW1iZXIsIHRoaW5fZmFjX2Jhc2U6IG51bWJlcikge1xuICAgIGNvbnN0IHpvb21fYmFzZSA9IDE7XG5cbiAgICBsZXQgem9vbSA9IHpvb21fYmFzZTtcbiAgICBsZXQgdGhpbl9mYWMgPSB0aGluX2ZhY19iYXNlO1xuXG4gICAgd2hpbGUgKCgoamxhdCAlIHRoaW5fZmFjKSAhPSAwKSB8fCAoKGlsb24gJSB0aGluX2ZhYykgIT0gMCkpIHtcbiAgICAgICAgem9vbSArPSAxO1xuICAgICAgICB0aGluX2ZhYyAvPSAyO1xuICAgIH1cblxuICAgIHJldHVybiB6b29tO1xufVxuXG5mdW5jdGlvbiogemlwKC4uLmFyZ3M6IGFueVtdKSB7XG5cdGNvbnN0IGl0ZXJhdG9ycyA9IGFyZ3MubWFwKHggPT4geFtTeW1ib2wuaXRlcmF0b3JdKCkpO1xuXHR3aGlsZSAodHJ1ZSkge1xuXHRcdGNvbnN0IGN1cnJlbnQgPSBpdGVyYXRvcnMubWFwKHggPT4geC5uZXh0KCkpO1xuXHRcdGlmIChjdXJyZW50LnNvbWUoeCA9PiB4LmRvbmUpKSB7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0eWllbGQgY3VycmVudC5tYXAoeCA9PiB4LnZhbHVlKTtcblx0fVxufVxuXG5leHBvcnQge2hleDJyZ2JhLCByZ2JhMmhleCwgaGV4MnJnYiwgcmdiMmhleCwgcmdiMmhzdiwgaHN2MnJnYiwgemlwLCBnZXRNaW5ab29tfTsiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwidGhpcyIsInByb3h5TWFya2VyIiwiU3ltYm9sIiwiY3JlYXRlRW5kcG9pbnQiLCJyZWxlYXNlUHJveHkiLCJ0aHJvd01hcmtlciIsImlzT2JqZWN0IiwidmFsIiwidHJhbnNmZXJIYW5kbGVycyIsIk1hcCIsImNhbkhhbmRsZSIsInNlcmlhbGl6ZSIsIm9iaiIsInBvcnQxIiwicG9ydDIiLCJNZXNzYWdlQ2hhbm5lbCIsImV4cG9zZSIsImRlc2VyaWFsaXplIiwicG9ydCIsInN0YXJ0IiwiY3JlYXRlUHJveHkiLCJ0YXJnZXQiLCJ2YWx1ZSIsInNlcmlhbGl6ZWQiLCJFcnJvciIsImlzRXJyb3IiLCJtZXNzYWdlIiwibmFtZSIsInN0YWNrIiwiT2JqZWN0IiwiYXNzaWduIiwiZXAiLCJzZWxmIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhbGxiYWNrIiwiZXYiLCJkYXRhIiwiaWQiLCJ0eXBlIiwicGF0aCIsImFyZ3VtZW50TGlzdCIsIm1hcCIsImZyb21XaXJlVmFsdWUiLCJyZXR1cm5WYWx1ZSIsInBhcmVudCIsInNsaWNlIiwicmVkdWNlIiwicHJvcCIsInJhd1ZhbHVlIiwiYXBwbHkiLCJwcm94eSIsInRyYW5zZmVycyIsInRyYW5zZmVyQ2FjaGUiLCJzZXQiLCJ0cmFuc2ZlciIsInVuZGVmaW5lZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiY2F0Y2giLCJ0aGVuIiwid2lyZVZhbHVlIiwidHJhbnNmZXJhYmxlcyIsInRvV2lyZVZhbHVlIiwicG9zdE1lc3NhZ2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2xvc2VFbmRQb2ludCIsImVuZHBvaW50IiwiY29uc3RydWN0b3IiLCJpc01lc3NhZ2VQb3J0IiwiY2xvc2UiLCJ0aHJvd0lmUHJveHlSZWxlYXNlZCIsImlzUmVsZWFzZWQiLCJpc1Byb3h5UmVsZWFzZWQiLCJQcm94eSIsImdldCIsIl90YXJnZXQiLCJyZXF1ZXN0UmVzcG9uc2VNZXNzYWdlIiwicCIsInRvU3RyaW5nIiwibGVuZ3RoIiwiciIsImJpbmQiLCJfdGhpc0FyZyIsInJhd0FyZ3VtZW50TGlzdCIsImxhc3QiLCJwcm9jZXNzQXJndW1lbnRzIiwiY29uc3RydWN0IiwicHJvY2Vzc2VkIiwidiIsImFyciIsIkFycmF5IiwicHJvdG90eXBlIiwiY29uY2F0IiwiV2Vha01hcCIsImhhbmRsZXIiLCJzZXJpYWxpemVkVmFsdWUiLCJtc2ciLCJmaWxsIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsImpvaW4iLCJsIiwibG5nIiwibGF0IiwiaXNOYU4iLCJ0b01lcmNhdG9yQ29vcmQiLCJ4IiwieSIsIlBJIiwibG9nIiwidGFuIiwiZmllbGRfbGF0cyIsImZpZWxkX2xvbnMiLCJmaWVsZF91IiwiZmllbGRfdiIsInRoaW5fZmFjX2Jhc2UiLCJCQVJCX0RJTVMiLCJCQVJCX1dJRFRIIiwiQkFSQl9URVhfV0lEVEgiLCJCQVJCX0hFSUdIVCIsIkJBUkJfVEVYX0hFSUdIVCIsIkJBUkJfVEVYX1dSQVAiLCJuX2xhdHMiLCJuX2xvbnMiLCJuX2VsZW1zX3RjIiwicHRzIiwiRmxvYXQzMkFycmF5Iiwib2Zmc2V0IiwidGV4X2Nvb3JkcyIsImlzdGFydF9wdHMiLCJpc3RhcnRfdGMiLCJiYXJiX3dpZHRoX2ZyYWMiLCJiYXJiX2hlaWdodF9mcmFjIiwiZm9yRWFjaCIsImlsYXQiLCJsb24iLCJpbG9uIiwiem9vbSIsImpsYXQiLCJ0aGluX2ZhYyIsImdldE1pblpvb20iLCJ1IiwiYmFyYl9tYWciLCJyb3VuZCIsImh5cG90IiwiYmFyYl9hbmciLCJhdGFuMiIsInB0X2xsIiwiTG5nTGF0IiwiaWNybnIiLCJhY3R1YWxfaWNybnIiLCJtYXgiLCJtaW4iLCJpX2JhcmIiLCJqX2JhcmIiLCJ0ZXhfd2lkdGgiLCJ0ZXhfaGVpZ2h0IiwibmkiLCJ1YmkiLCJ2ZXJ0cyIsImZsYXQiLCJwdCIsImNkIiwidGMiLCJsaW5lcyIsIm5fcG9pbnRzX3Blcl92ZXJ0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwiayIsIm5fb3V0X3ZlcnRzIiwiYSIsImIiLCJhcnlfbGVucyIsIm5wcHYiLCJyZXQiLCJpbG5zIiwia2V5cyIsImNvbXB1dGVfbm9ybWFsX3ZlYyIsInB0MSIsInB0MiIsImxpbmVfdmVjX3giLCJsaW5lX3ZlY195IiwibGluZV92ZWNfbWFnIiwibGluZSIsInB0X3ByZXYiLCJ0Y19wcmV2IiwidGV4Y29vcmRzIiwiYXJ5X2l2dCIsInB0X3RoaXMiLCJwdF9uZXh0IiwidGNfdGhpcyIsImV4dF94IiwiZXh0X3kiLCJpdnQiLCJpY2QiXSwic291cmNlUm9vdCI6IiJ9